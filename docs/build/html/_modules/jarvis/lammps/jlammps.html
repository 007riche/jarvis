
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>jarvis.lammps.jlammps &#8212; jarvis-tools v2018.10.22 documentation</title>
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">jarvis-tools v2018.10.22 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for jarvis.lammps.jlammps</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span>  <span class="n">unicode_literals</span><span class="p">,</span> <span class="n">print_function</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Helper function for running LAMMPS</span>
<span class="sd">Used for defects, surface and phonon calculations</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">monty.json</span> <span class="k">import</span> <span class="n">MontyEncoder</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">matrix</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">ase</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">phonopy</span> <span class="k">import</span> <span class="n">Phonopy</span>
<span class="kn">from</span> <span class="nn">phonopy.file_IO</span> <span class="k">import</span> <span class="n">parse_FORCE_CONSTANTS</span><span class="p">,</span> <span class="n">write_FORCE_CONSTANTS</span>
<span class="kn">from</span> <span class="nn">phonopy.structure.atoms</span> <span class="k">import</span> <span class="n">Atoms</span> <span class="k">as</span> <span class="n">PhonopyAtoms</span>

<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="k">import</span> <span class="n">Structure</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.vasp.inputs</span> <span class="k">import</span> <span class="n">Incar</span><span class="p">,</span> <span class="n">Poscar</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.surface</span> <span class="k">import</span>  <span class="n">Slab</span><span class="p">,</span> <span class="n">SlabGenerator</span><span class="p">,</span> <span class="n">generate_all_slabs</span><span class="p">,</span><span class="n">get_symmetrically_distinct_miller_indices</span>
<span class="kn">from</span> <span class="nn">ase.lattice.surface</span> <span class="k">import</span> <span class="n">surface</span>
<span class="kn">from</span> <span class="nn">pymatgen.ext.matproj</span> <span class="k">import</span> <span class="n">MPRester</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.lattice</span> <span class="k">import</span> <span class="n">Lattice</span>
<span class="kn">from</span> <span class="nn">pymatgen.symmetry.analyzer</span> <span class="k">import</span> <span class="n">SpacegroupAnalyzer</span>
<span class="kn">from</span> <span class="nn">jarvis.lammps.Surf_Def</span> <span class="k">import</span> <span class="n">vac_antisite_def_struct_gen</span><span class="p">,</span><span class="n">pmg_surfer</span><span class="p">,</span><span class="n">surfer</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">json</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">os</span><span class="o">,</span><span class="nn">subprocess</span><span class="o">,</span><span class="nn">socket</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.ase</span> <span class="k">import</span> <span class="n">AseAtomsAdaptor</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">fortranformat</span> <span class="k">as</span> <span class="nn">fform</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="k">import</span> <span class="n">Structure</span>
<span class="kn">from</span> <span class="nn">phonopy.structure.atoms</span> <span class="k">import</span> <span class="n">Atoms</span> <span class="k">as</span> <span class="n">PhonopyAtoms</span>
<span class="kn">from</span> <span class="nn">ase.calculators.lammpsrun</span> <span class="k">import</span> <span class="n">LAMMPS</span><span class="p">,</span> <span class="n">prism</span>

<span class="n">input_nobox</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;input_nobox&#39;</span><span class="p">]</span>
<span class="n">input_box</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;input_box&#39;</span><span class="p">]</span>
<span class="n">lammps_exec</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;lammps_exec&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="get_phonopy_atoms"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.get_phonopy_atoms">[docs]</a><span class="k">def</span> <span class="nf">get_phonopy_atoms</span><span class="p">(</span><span class="n">mat</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to convert pymatgen structure object to phonopy atoms</span>

<span class="sd">    Args:</span>
<span class="sd">        mat: pymatgen structure object</span>
<span class="sd">    Returns:</span>
<span class="sd">           phonopy atoms object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">mat</span><span class="p">]</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">coords</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">mat</span><span class="p">]</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span>
    <span class="n">p</span><span class="o">=</span><span class="n">PhonopyAtoms</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="n">symbols</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span></div>
<div class="viewcode-block" id="ZipDir"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.ZipDir">[docs]</a><span class="k">def</span> <span class="nf">ZipDir</span><span class="p">(</span><span class="n">inputDir</span><span class="p">,</span> <span class="n">outputZip</span><span class="p">,</span><span class="n">contents</span><span class="o">=</span><span class="p">[]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zip up a directory and preserve symlinks and empty directories</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">zipOut</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">outputZip</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span><span class="p">)</span>
    <span class="n">tmp</span><span class="o">=</span><span class="n">contents</span>
    <span class="n">rootLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">inputDir</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_ArchiveDirectory</span><span class="p">(</span><span class="n">parentDirectory</span><span class="p">):</span>
        <span class="c1">#contents = os.listdir(parentDirectory)</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">tmp</span><span class="c1">#[&#39;init.mod&#39;, &#39;potential.mod&#39;, &#39;in.elastic&#39;, &#39;data&#39;,  &#39;log.lammps&#39;, &#39;restart.equil&#39;,&#39;data0&#39; ]</span>
        <span class="c1">#store empty directories</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">contents</span><span class="p">:</span>
            <span class="c1">#http://www.velocityreviews.com/forums/t318840-add-empty-directory-using-zipfile.html</span>
            <span class="n">archiveRoot</span> <span class="o">=</span> <span class="n">parentDirectory</span><span class="p">[</span><span class="n">rootLen</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">zipInfo</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipInfo</span><span class="p">(</span><span class="n">archiveRoot</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">zipOut</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="n">zipInfo</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="n">fullPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parentDirectory</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">fullPath</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">fullPath</span><span class="p">):</span>
                <span class="n">_ArchiveDirectory</span><span class="p">(</span><span class="n">fullPath</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">archiveRoot</span> <span class="o">=</span> <span class="n">fullPath</span><span class="p">[</span><span class="n">rootLen</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">fullPath</span><span class="p">):</span>
                    <span class="c1"># http://www.mail-archive.com/python-list@python.org/msg34223.html</span>
                    <span class="n">zipInfo</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipInfo</span><span class="p">(</span><span class="n">archiveRoot</span><span class="p">)</span>
                    <span class="n">zipInfo</span><span class="o">.</span><span class="n">create_system</span> <span class="o">=</span> <span class="mi">3</span>
                    <span class="c1"># long type of hex val of &#39;0xA1ED0000L&#39;,</span>
                    <span class="c1"># say, symlink attr magic...</span>
                    <span class="c1">#zipInfo.external_attr = 0777 &lt;&lt; 16L</span>
                    <span class="n">zipInfo</span><span class="o">.</span><span class="n">external_attr</span> <span class="o">=</span> <span class="s1">&#39;2716663808L&#39;</span>
                    <span class="n">zipOut</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="n">zipInfo</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">readlink</span><span class="p">(</span><span class="n">fullPath</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">zipOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fullPath</span><span class="p">,</span> <span class="n">archiveRoot</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span><span class="p">)</span>
    <span class="n">_ArchiveDirectory</span><span class="p">(</span><span class="n">inputDir</span><span class="p">)</span>

    <span class="n">zipOut</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_struct_from_mp"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.get_struct_from_mp">[docs]</a><span class="k">def</span> <span class="nf">get_struct_from_mp</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">MAPI_KEY</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">all_structs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetches the structure corresponding to the given formula</span>
<span class="sd">    from the materialsproject database.</span>
<span class="sd">    Note: Get the api key from materialsproject website.</span>

<span class="sd">    Args:</span>
<span class="sd">        formula: Example Al-Ni, Al, Al2O3 etc.</span>
<span class="sd">        MAPI_KEY: key for database</span>
<span class="sd">        all_structs: if all structures or only stable structures </span>
<span class="sd">    Returns:</span>
<span class="sd">         structures</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">MAPI_KEY</span><span class="p">:</span>
        <span class="n">MAPI_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MAPI_KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">MAPI_KEY</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;API key not provided&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;get API KEY from materialsproject and set it to the MAPI_KEY environment variable. aborting ... &#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">MPRester</span><span class="p">(</span><span class="n">MAPI_KEY</span><span class="p">)</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">formula</span><span class="p">)</span>
        <span class="n">structures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">number of structures matching the chemical formula </span><span class="si">{0}</span><span class="s2"> = </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The one with the the lowest energy above the hull is returned, unless all_structs is set to True&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">mpid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;material_id&#39;</span><span class="p">])</span>
            <span class="n">x</span><span class="p">[</span><span class="n">mpid</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;e_above_hull&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">all_structs</span><span class="p">:</span>
                <span class="n">structure</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_structure_by_material_id</span><span class="p">(</span><span class="n">mpid</span><span class="p">)</span>
                <span class="n">structure</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="n">structures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">all_structs</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">structures</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mineah_key</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The id of the material corresponding to the lowest energy above the hull = </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mineah_key</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">mineah_key</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">mineah_key</span><span class="p">,</span><span class="n">m</span><span class="o">.</span><span class="n">get_structure_by_material_id</span><span class="p">(</span><span class="n">mineah_key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="run_job"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.run_job">[docs]</a><span class="k">def</span> <span class="nf">run_job</span><span class="p">(</span><span class="n">mat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{},</span><span class="n">jobname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Generic  function for running LAMMPS job</span>

<span class="sd">    Args:</span>
<span class="sd">        mat: Poscar object</span>
<span class="sd">        parameters: parameters with LAMMPS input information</span>
<span class="sd">        jobname: a user-defined jobname</span>
<span class="sd">    Returns:</span>
<span class="sd">          en: final enery</span>
<span class="sd">          final_str: final structure</span>
<span class="sd">          forces: forces on final structure</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="c1">#def run_job(mat=None,parameters = {&#39;exec&#39;:&#39;/cluster/bin/lmp_ctcms-14439-knc6-2&#39;,&#39;pair_style&#39;:&#39;comb3 polar_on&#39;,&#39;pair_coeff&#39;:None,&#39;atom_style&#39;: &#39;charge&#39; ,&#39;control_file&#39;:&#39;/home/kamal/inelast.mod&#39;},jobname=&#39;&#39;):</span>
    <span class="n">jobname</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span>
    <span class="c1">#if jobname.startswith(&#39;bulk&#39;) or jobname.startswith(&#39;sbulk&#39;):</span>
    <span class="c1">#   parameters[&#39;control_file&#39;]=&#39;/home/kamal/inelast.mod&#39;</span>
    <span class="c1">#else:</span>
    <span class="c1">#   parameters[&#39;control_file&#39;]=&#39;/home/kamal/inelast_nobox.mod&#39;</span>
       
    <span class="n">folder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jobname</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">jobname</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">jobname</span><span class="p">))</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;folder name&quot;</span><span class="p">,</span><span class="n">folder</span><span class="p">)</span> 
    <span class="n">forces</span><span class="o">=</span><span class="s1">&#39;na&#39;</span>
    <span class="k">try</span><span class="p">:</span>
       
       <span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">press</span><span class="p">,</span><span class="n">toten</span><span class="p">,</span><span class="n">c11</span><span class="p">,</span><span class="n">c22</span><span class="p">,</span><span class="n">c33</span><span class="p">,</span><span class="n">c12</span><span class="p">,</span><span class="n">c13</span><span class="p">,</span><span class="n">c23</span><span class="p">,</span><span class="n">c44</span><span class="p">,</span><span class="n">c55</span><span class="p">,</span><span class="n">c66</span><span class="p">,</span><span class="n">c14</span><span class="p">,</span><span class="n">c16</span><span class="p">,</span><span class="n">c24</span><span class="p">,</span><span class="n">c25</span><span class="p">,</span><span class="n">c26</span><span class="p">,</span><span class="n">c34</span><span class="p">,</span><span class="n">c35</span><span class="p">,</span><span class="n">c36</span><span class="p">,</span><span class="n">c45</span><span class="p">,</span><span class="n">c46</span><span class="p">,</span><span class="n">c56</span><span class="p">)</span><span class="o">=</span><span class="n">analyz_loge</span><span class="p">(</span><span class="s1">&#39;./log.lammps&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> 
        <span class="n">nprocs</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">nnodes</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;submit_job&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;#!/bin/bash&quot;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;#PBS -N &quot;</span><span class="p">)</span><span class="o">+</span><span class="n">jobname</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;#PBS -l walltime=0:30:00&quot;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;#PBS -o test.log&quot;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;#PBS -m abe&quot;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;#PBS -j oe&quot;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;#PBS -r n&quot;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;#PBS -l nodes=&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nnodes</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;ppn=&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">nprocs</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nnodes</span><span class="p">)))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="c1">#line=str(&quot;#PBS -l pmem=&quot;)+str(mem)+&#39;\n&#39;</span>
        <span class="c1">#f.write(line)</span>
        <span class="nb">dir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;cd &quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">=</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span>
        <span class="n">job_bin</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;exec&#39;</span><span class="p">])</span><span class="c1">#str(&quot;mpirun /cluster/bin/lmp_ctcms-14439-knc6 &lt;in.elastic &gt;out&quot;)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;job_bin&#39;</span><span class="p">,</span><span class="n">job_bin</span><span class="p">)</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">job_bin</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">write_lammps_data</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">mat</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
        <span class="n">write_lammps_in</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">mat</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span><span class="n">lammps_in</span><span class="o">=</span><span class="s2">&quot;init.mod&quot;</span><span class="p">,</span><span class="n">lammps_in1</span><span class="o">=</span><span class="s2">&quot;potential.mod&quot;</span><span class="p">,</span><span class="n">lammps_in2</span><span class="o">=</span><span class="s2">&quot;in.elastic&quot;</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">)</span>
        <span class="n">initial_str</span><span class="o">=</span><span class="n">read_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span><span class="n">ff</span><span class="o">=</span><span class="s2">&quot;potential.mod&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cluster</span><span class="o">==</span><span class="s1">&#39;sun&#39;</span><span class="p">:</span> <span class="c1">#sungrid engine</span>
        <span class="c1">#if &#39;ruth&#39; in socket.gethostname() or &#39;r049&#39; in socket.gethostname():</span>
           <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;job.out&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">&#39;qsub&#39;</span><span class="p">,</span><span class="s1">&#39;-cwd&#39;</span><span class="p">,</span> <span class="s1">&#39;-pe&#39;</span><span class="p">,</span> <span class="s1">&#39;nodal&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;submit_job&#39;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                     <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
                <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
                <span class="n">job_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Your job&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
           <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
           <span class="k">while</span> <span class="n">status</span> <span class="o">!=</span><span class="kc">False</span><span class="p">:</span>
             <span class="k">try</span><span class="p">:</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;qstat -j &quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
                <span class="n">a</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                   <span class="n">status</span><span class="o">=</span><span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                   <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
             <span class="k">except</span><span class="p">:</span>
                   <span class="n">status</span><span class="o">=</span><span class="kc">False</span>
                   <span class="c1"># print &quot;whattyhjkl;&#39;&quot;</span>
        <span class="k">elif</span> <span class="n">cluster</span><span class="o">==</span><span class="s1">&#39;pbs&#39;</span><span class="p">:</span>
           <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;cluster=&#39;</span><span class="p">,</span><span class="n">cluster</span><span class="p">)</span>
        <span class="c1">#elif &#39;dobby&#39; in socket.gethostname():</span>
           <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;job.out&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">&#39;qsub&#39;</span><span class="p">,</span> <span class="s1">&#39;submit_job&#39;</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                     <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
                <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
                <span class="c1">#self.job_id = stdout.rstrip(&#39;\n&#39;).split()[-1]</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;stdout,stderr&quot;</span><span class="p">,</span><span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span>
                <span class="n">job_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="c1">#str(stdout.rstrip(&#39;\n&#39;).split()[-1])</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
           <span class="n">status</span> <span class="o">=</span> <span class="kc">True</span>
           <span class="k">while</span> <span class="n">status</span> <span class="o">!=</span><span class="kc">False</span><span class="p">:</span>
             <span class="c1">#print (&quot;status=&quot;,status, job_id)</span>
             <span class="k">try</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;qstat,jobid comeonnn&quot;</span><span class="p">,</span><span class="n">job_id</span><span class="p">)</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;qstat&#39;</span><span class="p">,</span> <span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="n">job_id</span><span class="p">])</span>
                <span class="c1">#state = output.rstrip(&#39;\n&#39;).split(&#39;\n&#39;)[-1].split()[-2]</span>
                <span class="c1">#time.sleep(5)</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span><span class="n">output</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;Unknown&#39;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                <span class="c1">#if &#39;C&#39; in output or &#39;Unknown Job Id Error&#39; in output:</span>
                   <span class="n">status</span><span class="o">=</span><span class="kc">False</span>
             <span class="k">except</span><span class="p">:</span>
                    <span class="n">status</span><span class="o">=</span><span class="kc">False</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Error in job submission&quot;</span><span class="p">)</span>
                 


        <span class="k">else</span><span class="p">:</span>
           <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;socket error&quot;</span><span class="p">)</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="n">press</span><span class="p">,</span><span class="n">toten</span><span class="p">,</span><span class="n">c11</span><span class="p">,</span><span class="n">c22</span><span class="p">,</span><span class="n">c33</span><span class="p">,</span><span class="n">c12</span><span class="p">,</span><span class="n">c13</span><span class="p">,</span><span class="n">c23</span><span class="p">,</span><span class="n">c44</span><span class="p">,</span><span class="n">c55</span><span class="p">,</span><span class="n">c66</span><span class="p">,</span><span class="n">c14</span><span class="p">,</span><span class="n">c16</span><span class="p">,</span><span class="n">c24</span><span class="p">,</span><span class="n">c25</span><span class="p">,</span><span class="n">c26</span><span class="p">,</span><span class="n">c34</span><span class="p">,</span><span class="n">c35</span><span class="p">,</span><span class="n">c36</span><span class="p">,</span><span class="n">c45</span><span class="p">,</span><span class="n">c46</span><span class="p">,</span><span class="n">c56</span><span class="p">)</span><span class="o">=</span><span class="n">analyz_loge</span><span class="p">(</span><span class="s1">&#39;./log.lammps&#39;</span><span class="p">)</span>

    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;initial,final sr&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
    <span class="n">initial_str</span><span class="o">=</span><span class="n">read_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span><span class="n">ff</span><span class="o">=</span><span class="s2">&quot;potential.mod&quot;</span><span class="p">)</span>
    <span class="n">final_str</span><span class="o">=</span><span class="n">read_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s2">&quot;data0&quot;</span><span class="p">,</span><span class="n">ff</span><span class="o">=</span><span class="s2">&quot;potential.mod&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">forces</span><span class="o">=</span><span class="n">read_dump</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;0.dump&#39;</span><span class="p">,</span><span class="n">ff</span><span class="o">=</span><span class="s1">&#39;potential.mod&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
       <span class="k">pass</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;initial,final sr2&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

    <span class="n">data_cal</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">data_cal</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;jobname&#39;</span><span class="p">:</span><span class="n">jobname</span><span class="p">,</span><span class="s1">&#39;poscar&#39;</span><span class="p">:</span><span class="n">mat</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(),</span><span class="s1">&#39;initial_pos&#39;</span><span class="p">:</span><span class="n">initial_str</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(),</span><span class="s1">&#39;pair_style&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pair_style&#39;</span><span class="p">]),</span><span class="s1">&#39;pair_coeff&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pair_coeff&#39;</span><span class="p">]),</span><span class="s1">&#39;final_energy&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">toten</span><span class="p">),</span><span class="s1">&#39;en&#39;</span><span class="p">:</span><span class="n">en</span><span class="p">,</span><span class="s1">&#39;press&#39;</span><span class="p">:</span><span class="n">press</span><span class="p">,</span><span class="s1">&#39;final_str&#39;</span><span class="p">:</span><span class="n">final_str</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()})</span>
    <span class="n">json_file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">jobname</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">)</span>
    <span class="n">f_json</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">json_file</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f_json</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data_cal</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="bp">cls</span><span class="o">=</span> <span class="n">MontyEncoder</span><span class="p">))</span>
    <span class="n">f_json</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">en</span><span class="p">,</span><span class="n">final_str</span><span class="p">,</span><span class="n">forces</span></div>






<div class="viewcode-block" id="write_lammps_data"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.write_lammps_data">[docs]</a><span class="k">def</span> <span class="nf">write_lammps_data</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write lammps structure data</span>
<span class="sd">        from ase with custom modifications</span>

<span class="sd">        Args:</span>
<span class="sd">            structure: Structure object</span>
<span class="sd">            file:  intended file to write in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">structure</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">structure</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span> <span class="s2">&quot;poscar&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span> <span class="s2">&quot;new_pymatgen_slab.vasp&quot;</span><span class="p">)</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>

        <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s1">&#39;datafile (written by JARVIS-FF) </span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">()</span>
        <span class="kn">import</span> <span class="nn">ase.io.vasp</span>
        <span class="c1">#ase.io.vasp.write_vasp(&quot;POSCAR.1x1x1&quot;,atoms, label=&#39;444supercell&#39;,direct=True,sort=False)</span>
        <span class="n">n_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> </span><span class="se">\t</span><span class="s1"> atoms </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">n_atoms</span><span class="p">)</span>
        <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="n">tos</span> <span class="k">for</span> <span class="n">tos</span> <span class="ow">in</span> <span class="n">Poscar</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span><span class="o">.</span><span class="n">site_symbols</span><span class="p">]</span>
        <span class="c1">#species = [tos.symbol</span>
        <span class="c1">#               for tos in structure.types_of_specie]</span>
        <span class="n">n_atom_types</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;species&quot;</span><span class="p">,</span><span class="n">species</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">  atom types</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">n_atom_types</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">prism</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_cell</span><span class="p">())</span>
        <span class="n">xhi</span><span class="p">,</span> <span class="n">yhi</span><span class="p">,</span> <span class="n">zhi</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">xz</span><span class="p">,</span> <span class="n">yz</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_lammps_prism_str</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;0.0 </span><span class="si">%s</span><span class="s1">  xlo xhi</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">xhi</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;0.0 </span><span class="si">%s</span><span class="s1">  ylo yhi</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">yhi</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;0.0 </span><span class="si">%s</span><span class="s1">  zlo zhi</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">zhi</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">  xy xz yz</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">xz</span><span class="p">,</span> <span class="n">yz</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Atoms </span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">pos_to_lammps_str</span><span class="p">,</span>
                                  <span class="n">atoms</span><span class="o">.</span><span class="n">get_positions</span><span class="p">())):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">symbols</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
                    
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%6d</span><span class="s1"> </span><span class="si">%3d</span><span class="s1"> </span><span class="si">%6f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                            <span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span><span class="o">+</span><span class="nb">tuple</span><span class="p">(</span><span class="n">r</span><span class="p">))</span> <span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="write_lammps_in"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.write_lammps_in">[docs]</a><span class="k">def</span> <span class="nf">write_lammps_in</span><span class="p">(</span> <span class="n">structure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">lammps_in</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">lammps_in1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">lammps_in2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lammps_trj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">lammps_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write lammps input file</span>
<span class="sd">        from ase with custom modifications</span>
<span class="sd">        LAMMPS input is devided into three parts</span>

<span class="sd">        Args:</span>
<span class="sd">            structure: Structure object</span>
<span class="sd">            lammps_in: generally&quot;init.mod&quot;, with unit and conversion factor information</span>
<span class="sd">            lammps_in1: generally &quot;potential.mod&quot;, with force-field/potential style and element tyoe information</span>
<span class="sd">            lammps_in2: generally &quot;in.elastic&quot;, a generic main input file to be fed in LAMMPS usin lmp_*&lt;...,parameters[&#39;exec&#39;]</span>
<span class="sd">            parameters: input parameters</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>     
        <span class="n">structure</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>   
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">lammps_in</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">lammps_in1</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="c1">#potential.mod</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">lammps_in2</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s1">&#39;variable dump_file string &quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">lammps_trj</span><span class="p">)</span> <span class="o">+</span>
        <span class="p">(</span><span class="s1">&#39;variable up  equal 1.0e-6</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span><span class="o">+</span>
        <span class="p">(</span><span class="s1">&#39;variable cfac  equal 1.0e-4</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span><span class="o">+</span>
        <span class="p">(</span><span class="s1">&#39;variable cunits  string GPa</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span><span class="o">+</span>
        <span class="p">(</span><span class="s1">&#39;variable etol  equal 0</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span><span class="o">+</span>
        <span class="p">(</span><span class="s1">&#39;variable ftol  equal 1.0e-10</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span><span class="o">+</span>
        <span class="p">(</span><span class="s1">&#39;variable maxiter equal 1000</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span><span class="o">+</span>
        <span class="p">(</span><span class="s1">&#39;variable maxeval equal 10000</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span><span class="o">+</span>
        <span class="p">(</span><span class="s1">&#39;variable dmax equal 1.0e-2</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span><span class="o">+</span>
        <span class="p">(</span><span class="s1">&#39;variable data_file string &quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s2">&quot;data&quot;</span><span class="p">))</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
        <span class="n">pbc</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_pbc</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;control_file&#39;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="n">f2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;include </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span>  <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;control_file&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;units </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;units metal </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;atom_style&#39;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;atom_style </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;atom_style&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;atom_style atomic </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;boundary&#39;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;boundary </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;boundary&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;boundary </span><span class="si">%c</span><span class="s1"> </span><span class="si">%c</span><span class="s1"> </span><span class="si">%c</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
                    <span class="nb">tuple</span><span class="p">(</span><span class="s1">&#39;sp&#39;</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pbc</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;atom_modify sort 0 0.0 </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;neighbor&#39;</span> <span class="p">,</span><span class="s1">&#39;newton&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># If no_data_file,</span>
        <span class="c1"># write the simulation box and the atoms</span>
        <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="n">tos</span> <span class="k">for</span> <span class="n">tos</span> <span class="ow">in</span> <span class="n">Poscar</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span><span class="o">.</span><span class="n">site_symbols</span><span class="p">]</span>
        <span class="c1">#species = [tos.symbol for tos in structure.types_of_specie]</span>
        <span class="n">n_atom_types</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
        <span class="n">species_i</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species</span><span class="p">)])</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_data </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
        <span class="c1"># interaction</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">### interactions </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span> <span class="s1">&#39;lib&#39;</span> <span class="ow">in</span> <span class="n">parameters</span> <span class="p">):</span>
            <span class="n">lib</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;lib&#39;</span><span class="p">]</span>
            <span class="n">f1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">lib</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="s1">&#39;pair_style&#39;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;pair_coeff&#39;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">)</span> <span class="p">):</span>
            <span class="n">pair_style</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pair_style&#39;</span><span class="p">]</span>
            <span class="n">f1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;pair_style </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">pair_style</span><span class="p">)</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">()</span>
            <span class="c1">#species = [tos.symbol.replace(&quot;Mo&quot;,&quot;M&quot;) for tos in structure.types_of_specie] #For REBO Mo-S</span>
            <span class="c1">#species = [tos.symbol for tos in structure.types_of_specie]</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;site symbolss&quot;</span><span class="p">,</span><span class="n">Poscar</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span><span class="o">.</span><span class="n">site_symbols</span><span class="p">)</span>
            <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="n">tos</span> <span class="k">for</span> <span class="n">tos</span> <span class="ow">in</span> <span class="n">Poscar</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span><span class="o">.</span><span class="n">site_symbols</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pair_style&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;rebomos&#39;</span><span class="p">:</span>
                
                <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="n">tos</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Mo&quot;</span><span class="p">,</span><span class="s2">&quot;M&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">tos</span> <span class="ow">in</span> <span class="n">Poscar</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span><span class="o">.</span><span class="n">site_symbols</span><span class="p">]</span>
            <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">species</span><span class="p">:</span>
                <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">i</span>
            <span class="n">pair_coef</span> <span class="o">=</span>  <span class="s1">&#39;* * &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;pair_coeff&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">tag</span>
            <span class="n">f1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;pair_coeff </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">pair_coef</span><span class="p">)</span>

        

            <span class="n">masses</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span>  <span class="n">atoms</span><span class="o">.</span><span class="n">get_masses</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">masses</span><span class="p">:</span>
                   <span class="n">masses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">masses</span><span class="p">:</span>
                <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;mass&#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># default interaction</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;pair_style lj/cut 2.5 </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                    <span class="s1">&#39;pair_coeff * * 1 1 </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                    <span class="s1">&#39;mass * 1.0 </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;neighbor 1.0 nsq</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span>
        <span class="n">f1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;neigh_modify once no every 1 delay 0 check yes</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;min&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span> 
              <span class="n">f1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;min_style  cg</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span>
              <span class="n">f1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;min_modify           dmax $</span><span class="si">{dmax}</span><span class="s1"> line quadratic</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span>
        <span class="n">f1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;thermo          1</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span>
        <span class="n">f1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;thermo_style custom step temp press cpu pxx pyy pzz pxy pxz pyz ke pe etotal vol lx ly lz atoms</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span>
        <span class="c1">#f1.write(&#39;thermo_style custom step temp pe press pxx pyy pzz pxy pxz pyz lx ly lz vol\n&#39; )</span>
        <span class="n">f1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;thermo_modify norm no</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span>
     <span class="c1">#   if &#39;thermo_style&#39; in parameters:</span>
     <span class="c1">#       f.write(&#39;thermo_style %s\n&#39; % parameters[&#39;thermo_style&#39;])</span>
     <span class="c1">#   else:</span>
     <span class="c1">#       f.write((&#39;thermo_style custom %s\n&#39;) %</span>
     <span class="c1">#               (&#39; &#39;.join(self._custom_thermo_args)))</span>
     <span class="c1">#   if &#39;thermo_modify&#39; in parameters:</span>
     <span class="c1">#       f.write(&#39;thermo_modify %s\n&#39; % parameters[&#39;thermo_modify&#39;])</span>
     <span class="c1">#   else:</span>
     <span class="c1">#       f.write(&#39;thermo_modify flush yes\n&#39;)</span>
     <span class="c1">#   if &#39;thermo&#39; in parameters:</span>
     <span class="c1">#       f.write(&#39;thermo %s\n&#39; % parameters[&#39;thermo&#39;])</span>
     <span class="c1">#   else:</span>
     <span class="c1">#       f.write(&#39;thermo 1\n&#39;)            </span>
     <span class="c1">#   if &#39;minimize&#39; in parameters:</span>
     <span class="c1">#       f.write(&#39;minimize %s\n&#39; % parameters[&#39;minimize&#39;])</span>
     <span class="c1">#   if &#39;run&#39; in parameters:</span>
     <span class="c1">#       f.write(&#39;run %s\n&#39; % parameters[&#39;run&#39;])</span>
     <span class="c1">#   if not ((&#39;minimize&#39; in parameters) or (&#39;run&#39; in parameters)):</span>
     <span class="c1">#       f.write(&#39;run 0\n&#39;)</span>
     <span class="c1">#   if &#39;dump&#39; in parameters:</span>
     <span class="c1">#       f.write(&#39;dump %s\n&#39; % parameters[&#39;dump&#39;])</span>
     <span class="c1">#   else:</span>
     <span class="c1">#       f.write(&#39;dump dump_all all custom 1 %s id type x y z vx vy vz fx fy fz\n&#39; % lammps_trj)            </span>
     <span class="c1">#   f.write(&#39;print __end_of_ase_invoked_calculation__\n&#39;)</span>
     <span class="c1">#   f.write(&#39;log /dev/stdout\n&#39;)</span>
        <span class="k">if</span> <span class="s1">&#39;fix&#39;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;fix&#39;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;fix&#39;</span><span class="p">]:</span>
                    <span class="n">f1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;fix </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">f1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">f2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="analyz_loge"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.analyz_loge">[docs]</a><span class="k">def</span> <span class="nf">analyz_loge</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="s1">&#39;log.lammps&#39;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Analyzes log.lammps file,</span>
<span class="sd">    Please note, the output format heavily depends on the input file</span>
<span class="sd">    A generic inpu is taken here</span>

<span class="sd">    Args:</span>
<span class="sd">        log: path to log.lammps file</span>
<span class="sd">    Returns:</span>
<span class="sd">          en: energy/atom</span>
<span class="sd">          press: pressure</span>
<span class="sd">          toten: total energy</span>
<span class="sd">          cij: elastic constants</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">en</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">press</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c11</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c22</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c33</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c44</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c55</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c66</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c12</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c13</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c23</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c14</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c15</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c16</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c14</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c24</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c25</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c26</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c34</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c35</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c36</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c45</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c46</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c56</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
       <span class="n">logfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
       <span class="n">lines</span> <span class="o">=</span> <span class="n">logfile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
       <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
           <span class="k">if</span> <span class="s1">&#39;Loop time of&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">toten</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">12</span><span class="p">])</span>
               <span class="n">press</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
               <span class="n">press</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">press</span><span class="p">)</span><span class="o">*</span><span class="mf">0.0001</span>
               <span class="n">en</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">12</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">17</span><span class="p">])</span>
               <span class="k">break</span>
       <span class="n">logfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
       <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
       <span class="n">logfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
       <span class="n">lines</span> <span class="o">=</span> <span class="n">logfile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
       <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C11all = $</span><span class="si">{C11all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c11</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C22all = $</span><span class="si">{C22all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c22</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C33all = $</span><span class="si">{C33all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c33</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C12all = $</span><span class="si">{C12all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c12</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C13all = $</span><span class="si">{C13all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c13</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C23all = $</span><span class="si">{C23all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c23</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C44all = $</span><span class="si">{C44all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c44</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C55all = $</span><span class="si">{C55all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c55</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C66all = $</span><span class="si">{C66all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c66</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C14all = $</span><span class="si">{C14all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c14</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C16all = $</span><span class="si">{C16all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c16</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C24all = $</span><span class="si">{C24all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c24</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C25all = $</span><span class="si">{C25all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c25</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C26all = $</span><span class="si">{C26all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c26</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C34all = $</span><span class="si">{C34all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c34</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C35all = $</span><span class="si">{C35all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c35</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C36all = $</span><span class="si">{C36all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c36</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C45all = $</span><span class="si">{C45all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c45</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C46all = $</span><span class="si">{C46all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c46</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
           <span class="k">if</span> <span class="s1">&#39;print &quot;Elastic Constant C56all = $</span><span class="si">{C56all}</span><span class="s1"> $</span><span class="si">{cunits}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
               <span class="n">c56</span><span class="o">=</span><span class="p">((</span><span class="nb">str</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;GPa&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
       <span class="n">logfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
       <span class="k">pass</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">en</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="n">press</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">toten</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c11</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c22</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c33</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c12</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c13</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c23</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c44</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c55</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c66</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c14</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c16</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c24</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c25</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c26</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c34</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c35</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c36</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c45</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c46</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c56</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="read_dumpfull"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.read_dumpfull">[docs]</a><span class="k">def</span> <span class="nf">read_dumpfull</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads LAMMPS dump file</span>

<span class="sd">    Args:</span>
<span class="sd">        data: dump file path</span>
<span class="sd">        ff: potential.mod/potential information file path</span>
<span class="sd">    Returns:</span>
<span class="sd">          struct: Structure object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pot_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">pot_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="n">symb</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
    <span class="kn">from</span> <span class="nn">pymatgen.core.periodic_table</span> <span class="k">import</span> <span class="n">Element</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;pair_coeff&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
               <span class="n">sp</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
               <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">sp</span><span class="p">:</span>
                   <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">Element</span><span class="p">(</span><span class="n">el</span><span class="p">):</span>
                     <span class="c1">#if el==&#39;M&#39;:</span>
                   <span class="c1">#    el=&#39;Mo&#39;</span>
                   <span class="c1">#count=count+1</span>
                   <span class="c1">#if count &gt;4:</span>
                      <span class="n">symb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                   <span class="k">except</span><span class="p">:</span>
                      <span class="k">pass</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;symb=&quot;</span><span class="p">,</span><span class="n">symb</span><span class="p">)</span>

    <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;NUMBER OF ATOMS&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
             <span class="n">natoms</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;ITEM: BOX BOUNDS&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
             <span class="n">xlo</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
             <span class="n">xhi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
             <span class="n">ylo</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
             <span class="n">yhi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
             <span class="n">zlo</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
             <span class="n">zhi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">xy</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">yz</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">xz</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">natoms</span><span class="p">))</span>
    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">natoms</span><span class="p">))</span>
    <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">natoms</span><span class="p">))</span>
    <span class="n">lat</span><span class="o">=</span><span class="n">Lattice</span><span class="p">([[</span> <span class="n">xhi</span><span class="o">-</span><span class="n">xlo</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="n">xy</span><span class="p">,</span><span class="n">yhi</span><span class="o">-</span><span class="n">ylo</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="n">xz</span><span class="p">,</span><span class="n">yz</span><span class="p">,</span><span class="n">zhi</span><span class="o">-</span><span class="n">zlo</span><span class="p">]])</span>
    <span class="n">q</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">natoms</span><span class="p">))</span>
    <span class="n">typ</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">natoms</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;S20&quot;</span><span class="p">)</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span><span class="c1">#np.zeros((natoms))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;ITEM: ATOMS&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
           <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">natoms</span><span class="p">):</span>
                 <span class="n">typ</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">symb</span><span class="p">[</span><span class="nb">int</span><span class="p">(((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                 <span class="c1">#typ[j]=Element(str(symb[int(((lines[i+j+1]).split()[1]))-1]))</span>
                 <span class="c1">#typ[j]=(lines[i+j+1]).split()[1]</span>
                 <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>
                 <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">]</span>
                 <span class="n">z</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">]</span>
                 <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">pot_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1">#print (&#39;lat=&#39;,lat)</span>
   
    <span class="c1">#print (&#39;typ=&#39;,typ)</span>
    <span class="c1">#print (&#39;coords=&#39;,coords)</span>
    <span class="n">typ_sp</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">typ</span><span class="p">]</span>

    <span class="n">struct</span><span class="o">=</span><span class="n">Structure</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">typ_sp</span><span class="p">,</span><span class="n">coords</span><span class="p">,</span><span class="n">coords_are_cartesian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#print (&#39;struct&#39;,struct) </span>
    <span class="c1">#struct=Structure(lat,typ,coords,coords_are_cartesian=True)</span>
    <span class="k">return</span> <span class="n">struct</span></div>

<div class="viewcode-block" id="read_dump"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.read_dump">[docs]</a><span class="k">def</span> <span class="nf">read_dump</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Read LAMMPS dump file</span>

<span class="sd">    Args:</span>
<span class="sd">        data: dump file path</span>
<span class="sd">        ff: potential.mod/potential information file path</span>
<span class="sd">    Returns:</span>
<span class="sd">          struct: Structure object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pot_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">pot_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="n">symb</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
    <span class="kn">from</span> <span class="nn">pymatgen.core.periodic_table</span> <span class="k">import</span> <span class="n">Element</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;pair_coeff&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
               <span class="n">sp</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
               <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;spsplit&quot;</span><span class="p">,</span><span class="n">sp</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
               <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">sp</span><span class="p">:</span>
                   <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">Element</span><span class="p">(</span><span class="n">el</span><span class="p">):</span>
                      <span class="k">if</span> <span class="n">el</span><span class="o">==</span><span class="s1">&#39;M&#39;</span><span class="p">:</span>
                         <span class="n">el</span><span class="o">=</span><span class="s1">&#39;Mo&#39;</span>
                         <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span>
                         <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span><span class="mi">4</span><span class="p">:</span>
                              <span class="n">symb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                   <span class="k">except</span><span class="p">:</span>
                      <span class="k">pass</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;symb=&quot;</span><span class="p">,</span><span class="n">symb</span><span class="p">)</span>

    <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;NUMBER OF ATOMS&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
             <span class="n">natoms</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">natoms</span><span class="p">))</span>
    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">natoms</span><span class="p">))</span>
    <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">natoms</span><span class="p">))</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span><span class="c1">#np.zeros((natoms))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;ITEM: ATOMS&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
           <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">natoms</span><span class="p">):</span>
                 <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                 <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
                 <span class="n">z</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>
                 <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">pot_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">prop</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prop</span></div>

<div class="viewcode-block" id="read_data"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.read_data">[docs]</a><span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read LAMMPS data file</span>

<span class="sd">    Args:</span>
<span class="sd">        data: data file path</span>
<span class="sd">        ff: potential.mod/potential information file path</span>
<span class="sd">    Returns:</span>
<span class="sd">          struct: Structure object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pot_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">pot_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="n">symb</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
    <span class="kn">from</span> <span class="nn">pymatgen.core.periodic_table</span> <span class="k">import</span> <span class="n">Element</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;pair_coeff&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
               <span class="n">sp</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
               <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;spsplit&quot;</span><span class="p">,</span><span class="n">sp</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
               <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">sp</span><span class="p">:</span>
                   <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">Element</span><span class="p">(</span><span class="n">el</span><span class="p">):</span>
                     <span class="c1">#if el==&#39;M&#39;:</span>
                   <span class="c1">#    el=&#39;Mo&#39;</span>
                   <span class="c1">#count=count+1</span>
                   <span class="c1">#if count &gt;4:</span>
                      <span class="n">symb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                   <span class="k">except</span><span class="p">:</span>
                      <span class="k">pass</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;symb=&quot;</span><span class="p">,</span><span class="n">symb</span><span class="p">)</span> 
            
    <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;atoms&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
             <span class="n">natoms</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;types&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
             <span class="nb">print</span> <span class="p">(</span><span class="n">line</span><span class="p">)</span>
             <span class="n">ntypes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;xlo&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
             <span class="n">xlo</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
             <span class="n">xhi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;ylo&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
             <span class="n">ylo</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
             <span class="n">yhi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;zlo&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
             <span class="n">zlo</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
             <span class="n">zhi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;xy&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
             <span class="n">xy</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
             <span class="n">xz</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
             <span class="n">yz</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ntypes</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Something wrong in atom type assignment&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">symb</span><span class="p">),</span><span class="n">ntypes</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="n">lat</span><span class="o">=</span><span class="n">Lattice</span><span class="p">([[</span> <span class="n">xhi</span><span class="o">-</span><span class="n">xlo</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="n">xy</span><span class="p">,</span><span class="n">yhi</span><span class="o">-</span><span class="n">ylo</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[</span><span class="n">xz</span><span class="p">,</span><span class="n">yz</span><span class="p">,</span><span class="n">zhi</span><span class="o">-</span><span class="n">zlo</span><span class="p">]])</span>
    <span class="n">typ</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">natoms</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;S20&quot;</span><span class="p">)</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">natoms</span><span class="p">))</span>
    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">natoms</span><span class="p">))</span>
    <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">natoms</span><span class="p">))</span>
    <span class="n">q</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">natoms</span><span class="p">))</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;Atoms&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
           <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">natoms</span><span class="p">):</span>
                 <span class="c1">#print int(((lines[j+2]).split()[1]))-1</span>
                 <span class="n">typ</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">symb</span><span class="p">[</span><span class="nb">int</span><span class="p">(((</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                 <span class="n">q</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
                 <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>
                 <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">]</span>
                 <span class="n">z</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">]</span>
                 <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1">#print (&quot;info&quot;,(typ),&#39;coo&#39;,(coords),&#39;latt&#39;,lat)</span>
    <span class="n">pot_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">typ_sp</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">typ</span><span class="p">]</span>
    <span class="n">struct</span><span class="o">=</span><span class="n">Structure</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">typ_sp</span><span class="p">,</span><span class="n">coords</span><span class="p">,</span><span class="n">coords_are_cartesian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#print struct</span>
    <span class="c1">#finder = SpacegroupAnalyzer(struct)</span>
    <span class="c1">#num=finder.get_spacegroup_symbol()</span>
    <span class="c1">#print(num)</span>
    <span class="k">return</span> <span class="n">struct</span></div>

<div class="viewcode-block" id="smart_vac"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.smart_vac">[docs]</a><span class="k">def</span> <span class="nf">smart_vac</span><span class="p">(</span><span class="n">strt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to get all vacancy formation energies</span>

<span class="sd">    Args:</span>
<span class="sd">        strt: Structure object</span>
<span class="sd">        parameters: parameters with LAMMPS inputs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;control_file&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">input_nobox</span> <span class="c1">#&#39;/users/knc6/inelast_nobox.mod&#39;</span>
    <span class="n">vac_arr</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">sg_mat</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">strt</span><span class="p">)</span>
    <span class="n">mat_cvn</span> <span class="o">=</span> <span class="n">sg_mat</span><span class="o">.</span><span class="n">get_conventional_standard_structure</span><span class="p">()</span>
    <span class="n">mat_cvn</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="n">cellmax</span><span class="o">=</span><span class="mi">2</span> <span class="c1">#int(mat_cvn.composition.num_atoms)+int(mat_cvn.ntypesp)#5</span>
    <span class="n">ase_atoms</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">(</span><span class="n">mat_cvn</span><span class="p">)</span>
    <span class="n">ase_atoms</span><span class="o">=</span><span class="n">ase_atoms</span><span class="o">*</span><span class="p">(</span><span class="n">cellmax</span><span class="p">,</span><span class="n">cellmax</span><span class="p">,</span><span class="n">cellmax</span><span class="p">)</span>
    <span class="c1">#if len(ase_atoms) &gt;200:</span>
    <span class="c1">#   cellmax=1</span>
    <span class="c1">#else:</span>
    <span class="c1">#   cellmax=2</span>
    <span class="c1">#cellmax=int(mat_cvn.composition.num_atoms)+int(mat_cvn.ntypesp)#5</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;type of trt is= celmmax&quot;</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">strt</span><span class="p">),</span><span class="n">cellmax</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
       <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;int(strt.composition.num_atoms)&quot;</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">strt</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">num_atoms</span><span class="p">))</span>
       <span class="nb">print</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">strt</span><span class="o">.</span><span class="n">ntypesp</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
       <span class="k">pass</span>
    <span class="c1">#cellmax=int(strt.composition.num_atoms)+int(strt.ntypesp)</span>
    <span class="n">vac_done</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">tol</span><span class="o">=</span><span class="mf">0.01</span>   <span class="c1">#change 0.1</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">vac</span><span class="o">=</span><span class="n">vac_antisite_def_struct_gen</span><span class="p">(</span><span class="n">cellmax</span><span class="o">=</span><span class="n">cellmax</span><span class="p">,</span><span class="n">struct</span><span class="o">=</span><span class="n">strt</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Failed for v_1&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
        <span class="k">pass</span>
    <span class="n">def_list</span><span class="o">=</span><span class="p">[</span><span class="mi">100000</span>  <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vac</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
    <span class="k">while</span> <span class="n">vac_done</span> <span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vac</span><span class="o">=</span><span class="n">vac_antisite_def_struct_gen</span><span class="p">(</span><span class="n">cellmax</span><span class="o">=</span><span class="n">cellmax</span><span class="p">,</span><span class="n">struct</span><span class="o">=</span><span class="n">strt</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Failed for v_2&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">vac</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vac_arr</span><span class="p">:</span>
           <span class="k">try</span><span class="p">:</span>
               <span class="n">vac_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vac</span><span class="p">)</span>
               <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;in smart_vac(strt=None), cellmax,vac,vac_done=&quot;</span><span class="p">,</span><span class="n">cellmax</span><span class="p">,</span><span class="n">vac</span><span class="p">,</span><span class="n">vac_done</span><span class="p">)</span>
               <span class="n">def_list2</span><span class="p">,</span><span class="n">header_list</span><span class="o">=</span><span class="n">def_energy</span><span class="p">(</span><span class="n">vac</span><span class="o">=</span><span class="n">vac</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>
               <span class="n">diff</span><span class="o">=</span><span class="n">matrix</span><span class="p">(</span><span class="n">def_list</span><span class="p">)</span><span class="o">-</span><span class="n">matrix</span><span class="p">(</span><span class="n">def_list2</span><span class="p">)</span>
               <span class="n">diff_arr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
               <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;in smart_vac(strt=None diff_arr=&quot;</span><span class="p">,</span><span class="n">diff_arr</span><span class="p">)</span>
               <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;sleepig for 5&quot;</span><span class="p">)</span>
               <span class="c1">#time.sleep(5)</span>
           <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Failed for v_3&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
                <span class="k">pass</span>
           <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">diff_arr</span><span class="p">)</span><span class="o">&gt;</span><span class="n">tol</span><span class="p">:</span>
          <span class="c1"># for el in diff_arr:</span>
          <span class="c1">#     if abs(el)&gt;tol :</span>
                  <span class="c1"># print (&quot;in smart_vac(strt=None abs_el=&quot;,abs(el))</span>
                   <span class="n">vac_done</span><span class="o">=</span><span class="mi">0</span>
                   <span class="n">cellmax</span><span class="o">=</span><span class="n">cellmax</span><span class="o">+</span><span class="mi">1</span>
                   <span class="n">ase_atoms</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">(</span><span class="n">mat_cvn</span><span class="p">)</span>
                   <span class="n">ase_atoms</span><span class="o">=</span><span class="n">ase_atoms</span><span class="o">*</span><span class="p">(</span><span class="n">cellmax</span><span class="p">,</span><span class="n">cellmax</span><span class="p">,</span><span class="n">cellmax</span><span class="p">)</span>
                   <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ase_atoms</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">50</span><span class="p">:</span>
                      <span class="n">vac_done</span><span class="o">=</span><span class="mi">1</span>
                      <span class="k">break</span>
                   <span class="n">def_list</span><span class="o">=</span><span class="n">def_list2</span>
           <span class="k">else</span><span class="p">:</span>
               <span class="n">vac_done</span><span class="o">=</span><span class="mi">1</span>
<span class="c1">#        cellmax=cellmax+1</span>
    <span class="k">return</span> <span class="n">def_list</span><span class="p">,</span><span class="n">header_list</span></div>

<div class="viewcode-block" id="smart_surf"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.smart_surf">[docs]</a><span class="k">def</span> <span class="nf">smart_surf</span><span class="p">(</span><span class="n">strt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to get all surface energies</span>

<span class="sd">    Args:</span>
<span class="sd">        strt: Structure object</span>
<span class="sd">        parameters: parameters with LAMMPS inputs</span>
<span class="sd">        layers: starting number of layers</span>
<span class="sd">        tol: surface energy tolerance for convergence</span>
<span class="sd">    Returns:</span>
<span class="sd">          surf_list: list of surface energies</span>
<span class="sd">          surf_header_list: list of surface names</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;control_file&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">input_nobox</span> <span class="c1">#&#39;/users/knc6/inelast_nobox.mod&#39;</span>
    <span class="n">sg_mat</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">strt</span><span class="p">)</span>
    <span class="n">mat_cvn</span> <span class="o">=</span> <span class="n">sg_mat</span><span class="o">.</span><span class="n">get_conventional_standard_structure</span><span class="p">()</span>
    <span class="n">mat_cvn</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">layers</span><span class="o">=</span><span class="mi">3</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">get_symmetrically_distinct_miller_indices</span><span class="p">(</span><span class="n">mat_cvn</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ase_atoms</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">(</span><span class="n">mat_cvn</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="n">ase_slab</span> <span class="o">=</span> <span class="n">surface</span><span class="p">(</span><span class="n">ase_atoms</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">layers</span><span class="p">)</span>
        <span class="n">ase_slab</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">vacuum</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ase_slab</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
           <span class="n">layers</span><span class="o">=</span><span class="mi">3</span>
    <span class="n">surf_arr</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">surf_done</span><span class="o">=</span><span class="kc">True</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">surf</span><span class="o">=</span><span class="n">surfer</span><span class="p">(</span><span class="n">mat</span><span class="o">=</span><span class="n">strt</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="n">layers</span><span class="p">)</span>
        <span class="n">surf_list</span><span class="o">=</span><span class="p">[</span><span class="mi">100000</span>  <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">surf</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;in smart_surf :surf,surf_list=&quot;</span><span class="p">,</span><span class="n">surf</span><span class="p">,</span> <span class="n">surf_list</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
       <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Failed at s1&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
       <span class="k">pass</span>
    <span class="k">while</span> <span class="n">surf_done</span> <span class="p">:</span>
        <span class="n">layers</span><span class="o">=</span><span class="n">layers</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">get_symmetrically_distinct_miller_indices</span><span class="p">(</span><span class="n">mat_cvn</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ase_atoms</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">(</span><span class="n">mat_cvn</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">ase_slab</span> <span class="o">=</span> <span class="n">surface</span><span class="p">(</span><span class="n">ase_atoms</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">layers</span><span class="p">)</span>
            <span class="n">ase_slab</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">vacuum</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="c1">#if len(ase_slab) &gt; 100:</span>
            <span class="c1">#   surf_done=True</span>
            <span class="c1">#if (ase_slab.get_cell()[2][2]) &gt; 40:</span>
            <span class="c1">#   surf_done=True</span>
           

        <span class="k">try</span><span class="p">:</span>  
           <span class="n">surf</span><span class="o">=</span><span class="n">surfer</span><span class="p">(</span><span class="n">mat</span><span class="o">=</span><span class="n">strt</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="n">layers</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
           
           <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Failed at s2&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
           <span class="k">pass</span>
        <span class="k">if</span> <span class="n">surf</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">surf_arr</span><span class="p">:</span>
           <span class="n">surf_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surf</span><span class="p">)</span>
           <span class="k">try</span><span class="p">:</span>
               <span class="n">surf_list2</span><span class="p">,</span><span class="n">surf_header_list</span><span class="o">=</span><span class="n">surf_energy</span><span class="p">(</span><span class="n">surf</span><span class="o">=</span><span class="n">surf</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>
               <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;in smart_surf :surf2,surf_list2=&quot;</span><span class="p">,</span><span class="n">surf_list2</span><span class="p">,</span><span class="n">surf_header_list</span><span class="p">)</span>
               <span class="n">diff</span><span class="o">=</span><span class="n">matrix</span><span class="p">(</span><span class="n">surf_list</span><span class="p">)</span><span class="o">-</span><span class="n">matrix</span><span class="p">(</span><span class="n">surf_list2</span><span class="p">)</span>
               <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;in smart_surf :surf3,surf_list3=&quot;</span><span class="p">,</span><span class="n">matrix</span><span class="p">(</span><span class="n">surf_list</span><span class="p">),</span><span class="n">matrix</span><span class="p">(</span><span class="n">surf_list2</span><span class="p">))</span>
               <span class="n">diff_arr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
           <span class="k">except</span><span class="p">:</span>
               <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Failed for s_3&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
               <span class="k">pass</span>
           <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ase_slab</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">50</span><span class="p">:</span>
                      <span class="n">surf_done</span><span class="o">=</span><span class="kc">True</span>
                      <span class="k">break</span>
          <span class="c1"># print (&quot;layersssssssssssssssssssssssss&quot;,layers,surf_done)</span>
                      <span class="k">break</span>
           <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">diff_arr</span><span class="p">)</span><span class="o">&gt;</span><span class="n">tol</span><span class="p">:</span>
           <span class="c1">#for el in diff_arr:</span>
           <span class="c1">#    if abs(el)&gt;tol :</span>
           <span class="c1">#        print (&quot;in smart_surf :abs el=&quot;,abs(el))</span>
                   <span class="n">surf_done</span><span class="o">=</span><span class="kc">True</span>
                   <span class="n">surf_list</span><span class="o">=</span><span class="n">surf_list2</span>
           <span class="k">else</span><span class="p">:</span>
                <span class="n">surf_done</span><span class="o">=</span><span class="kc">False</span>
    <span class="k">return</span> <span class="n">surf_list</span><span class="p">,</span><span class="n">surf_header_list</span></div>

<div class="viewcode-block" id="surf_energy"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.surf_energy">[docs]</a><span class="k">def</span> <span class="nf">surf_energy</span><span class="p">(</span><span class="n">surf</span><span class="o">=</span><span class="p">[],</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to get specific surface energies</span>

<span class="sd">    Args:</span>
<span class="sd">        surf: list of syrfaces</span>
<span class="sd">        parameters: LAMMPS input parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">          surf_list: list of surface energies</span>
<span class="sd">          surf_header_list: list of surface names</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="c1">#def surf_energy(surf=[],parameters = {&#39;pair_style&#39;:&#39;eam/alloy&#39;,&#39;pair_coeff&#39;:&#39;/scratch/lfs/kamal/POSMAT/Automatic2/Al03.eam.alloy&#39;,&#39;atom_style&#39;: &#39;charge&#39; ,&#39;control_file&#39;:&#39;/home/kamal/inelast.mod&#39;}):</span>
    <span class="n">surf_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">surf_header_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">fi</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;SURF.INFO&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">surf</span><span class="p">:</span>
        <span class="n">enp</span><span class="p">,</span><span class="n">strt</span><span class="p">,</span><span class="n">forces</span><span class="o">=</span><span class="n">run_job</span><span class="p">(</span><span class="n">mat</span><span class="o">=</span><span class="n">s</span><span class="p">,</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">)</span>
        <span class="c1">#strt=Structure.from_file(contc)</span>
        <span class="n">m</span><span class="o">=</span><span class="n">strt</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">comment</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;sbulk&#39;</span><span class="p">:</span>

           <span class="n">gs_energy</span><span class="o">=</span><span class="n">enp</span>
           <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;in surf_energy gs_energy for&quot;</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="n">gs_energy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="n">surf_en</span><span class="o">=</span><span class="mi">16</span><span class="o">*</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">enp</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">strt</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">num_atoms</span><span class="p">)</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">strt</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">num_atoms</span><span class="p">)</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">gs_energy</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
           <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;in surf_energy surf_en for&quot;</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="n">surf_en</span><span class="p">)</span>
           <span class="n">surf_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surf_en</span><span class="p">)</span>
           <span class="nb">print</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">surf_en</span><span class="p">)</span>
           <span class="n">line</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">surf_en</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
           <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">surf_list</span><span class="p">,</span><span class="n">surf_header_list</span></div>

<div class="viewcode-block" id="get_chem_pot"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.get_chem_pot">[docs]</a><span class="k">def</span> <span class="nf">get_chem_pot</span><span class="p">(</span><span class="n">s1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">s2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span> <span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get chemical potential given perfect and defect structures</span>

<span class="sd">    Args:</span>
<span class="sd">        s1: perfect Structure object</span>
<span class="sd">        s2: defect Structure object</span>
<span class="sd">        parameters: LAMMPS input parameter</span>
<span class="sd">    Returns:</span>
<span class="sd">           enp: energy per atom</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="c1">#def get_chem_pot(s1=None,s2=None,parameters= {&#39;pair_style&#39;:&#39;eam/alloy&#39;,&#39;pair_coeff&#39;:&#39;/scratch/lfs/kamal/POSMAT/Automatic2/Al03.eam.alloy&#39;,&#39;atom_style&#39;: &#39;charge&#39; ,&#39;control_file&#39;:&#39;/home/kamal/inelast.mod&#39;}):</span>
    <span class="n">s1</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> 
    <span class="n">s2</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> 
    <span class="n">s3</span><span class="o">=</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">s1</span><span class="p">))</span><span class="c1">#list(set(s1)-set(s2))</span>
    <span class="c1">#s3=[]</span>
    <span class="c1">#for el1 in s1:</span>
    <span class="c1">#     for el2 in s2:</span>
    <span class="c1">#         if el1 !=el2 and el1 not in s3:</span>
    <span class="c1">#            s3.append(el1)</span>
    <span class="c1">#         if el1 !=el2 and el2 not in s3:</span>
    <span class="c1">#            s3.append(el2)</span>
    <span class="c1">#             </span>
    <span class="c1">#from pymatgen.analysis.structure_matcher import StructureMatcher</span>
    <span class="c1">#print &quot;Mather&quot;,StructureMatcher().fit(s1, s2)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;s3   is   &quot;</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">s1</span><span class="p">),</span><span class="nb">type</span><span class="p">(</span><span class="n">s2</span><span class="p">),</span><span class="n">s3</span><span class="p">)</span>
    <span class="n">uniq</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">s3</span><span class="p">:</span>
        <span class="n">el</span><span class="o">=</span><span class="n">q</span><span class="o">.</span><span class="n">_species</span><span class="o">.</span><span class="n">elements</span> 
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">el</span><span class="p">:</span>
           <span class="nb">print</span>   <span class="p">(</span><span class="s2">&quot;j is &quot;</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">uniq</span><span class="p">:</span>   
              <span class="n">uniq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
              <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">=</span> <span class="n">get_struct_from_mp</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
              <span class="n">p</span><span class="o">=</span><span class="n">Poscar</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
              <span class="n">p</span><span class="o">.</span><span class="n">comment</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
              <span class="n">enp</span><span class="p">,</span><span class="n">strt</span><span class="p">,</span><span class="n">forces</span><span class="o">=</span><span class="n">run_job</span><span class="p">(</span><span class="n">mat</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniq</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;uniq problem&quot;</span><span class="p">,</span><span class="n">uniq</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">enp</span></div>

<div class="viewcode-block" id="calc_forces"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.calc_forces">[docs]</a><span class="k">def</span> <span class="nf">calc_forces</span><span class="p">(</span><span class="n">mat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate forces on atoms</span>
<span class="sd">   </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">enp</span><span class="p">,</span><span class="n">strt</span><span class="p">,</span><span class="n">forces</span><span class="o">=</span><span class="n">run_job</span><span class="p">(</span><span class="n">mat</span><span class="o">=</span><span class="n">mat</span><span class="p">,</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">forces</span></div>

<div class="viewcode-block" id="do_phonons"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.do_phonons">[docs]</a><span class="k">def</span> <span class="nf">do_phonons</span><span class="p">(</span><span class="n">strt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">c_size</span><span class="o">=</span><span class="mi">25</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setting up phonopy job using LAMMPS</span>

<span class="sd">    Args:</span>
<span class="sd">        strt: Structure object</span>
<span class="sd">        parameters: LAMMPS input file parameters</span>
<span class="sd">        c_size: cell-size </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
         
    <span class="n">p</span><span class="o">=</span> <span class="n">get_phonopy_atoms</span><span class="p">(</span><span class="n">mat</span><span class="o">=</span><span class="n">strt</span><span class="p">)</span>
    <span class="n">bulk</span> <span class="o">=</span><span class="n">p</span>
    
    <span class="n">dim1</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">c_size</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">strt</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">])))))</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">dim2</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c_size</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">strt</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]))))</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">dim3</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c_size</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">strt</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]))))</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">Poscar</span><span class="p">(</span><span class="n">strt</span><span class="p">)</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="s2">&quot;POSCAR&quot;</span><span class="p">)</span>
    <span class="n">tmp</span><span class="o">=</span><span class="n">strt</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">make_supercell</span><span class="p">([</span><span class="n">dim1</span><span class="p">,</span><span class="n">dim2</span><span class="p">,</span><span class="n">dim3</span><span class="p">])</span>
    <span class="n">Poscar</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="s2">&quot;POSCAR-Super.vasp&quot;</span><span class="p">)</span>
    
    <span class="n">phonon</span> <span class="o">=</span> <span class="n">Phonopy</span><span class="p">(</span><span class="n">bulk</span><span class="p">,[[</span><span class="n">dim1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">dim2</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">dim3</span><span class="p">]])</span><span class="c1">#,</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;[Phonopy] Atomic displacements:&quot;</span><span class="p">)</span>
    <span class="n">disps</span> <span class="o">=</span> <span class="n">phonon</span><span class="o">.</span><span class="n">get_displacements</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">disps</span><span class="p">:</span>
      <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;[Phonopy]&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">supercells</span> <span class="o">=</span> <span class="n">phonon</span><span class="o">.</span><span class="n">get_supercells_with_displacements</span><span class="p">()</span>

    <span class="c1"># Force calculations by calculator</span>
    <span class="n">set_of_forces</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">disp</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">scell</span> <span class="ow">in</span> <span class="n">supercells</span><span class="p">:</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="n">scell</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">(),</span>
			 <span class="n">scaled_positions</span><span class="o">=</span><span class="n">scell</span><span class="o">.</span><span class="n">get_scaled_positions</span><span class="p">(),</span>
			 <span class="n">cell</span><span class="o">=</span><span class="n">scell</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(),</span>
			 <span class="n">pbc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="o">+</span><span class="mi">1</span>

    <span class="n">mat</span> <span class="o">=</span> <span class="n">Poscar</span><span class="p">(</span><span class="n">AseAtomsAdaptor</span><span class="p">()</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">cell</span><span class="p">))</span>
    <span class="n">mat</span><span class="o">.</span><span class="n">comment</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;disp-&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span>
    <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;skip&#39;</span>
    <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;control_file&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;/users/knc6/in.phonon&#39;</span>
    <span class="c1">#a,b,forces=run_job(mat=mat,parameters={&#39;min&#39;:&#39;skip&#39;,&#39;pair_coeff&#39;: &#39;/data/knc6/JARVIS-FF-NEW/ALLOY4/Mishin-Ni-Al-2009.eam.alloy&#39;, &#39;control_file&#39;: &#39;/users/knc6/in.phonon&#39;, &#39;pair_style&#39;: &#39;eam/alloy&#39;, &#39;atom_style&#39;: &#39;charge&#39;})</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">forces</span><span class="o">=</span><span class="n">run_job</span><span class="p">(</span><span class="n">mat</span><span class="o">=</span><span class="n">mat</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;forces=&quot;</span><span class="p">,</span><span class="n">forces</span><span class="p">)</span>
    <span class="n">drift_force</span> <span class="o">=</span> <span class="n">forces</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;drift forces=&quot;</span><span class="p">,</span><span class="n">drift_force</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;[Phonopy] Drift force:&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%11.5f</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">3</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">drift_force</span><span class="p">))</span>
    <span class="c1"># Simple translational invariance</span>
    <span class="k">for</span> <span class="n">force</span> <span class="ow">in</span> <span class="n">forces</span><span class="p">:</span>
          <span class="n">force</span> <span class="o">-=</span> <span class="n">drift_force</span> <span class="o">/</span> <span class="n">forces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">set_of_forces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">forces</span><span class="p">)</span>
    <span class="n">phonon</span><span class="o">.</span><span class="n">produce_force_constants</span><span class="p">(</span><span class="n">forces</span><span class="o">=</span><span class="n">set_of_forces</span><span class="p">)</span>

    <span class="n">write_FORCE_CONSTANTS</span><span class="p">(</span><span class="n">phonon</span><span class="o">.</span><span class="n">get_force_constants</span><span class="p">(),</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;FORCE_CONSTANTS&quot;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;[Phonopy] Phonon frequencies at Gamma:&quot;</span><span class="p">)</span></div>
	<span class="c1">#for i, freq in enumerate(phonon.get_frequencies((0, 0, 0))):</span>
	<span class="c1">#    print (&quot;[Phonopy] %3d: %10.5f THz&quot; %  (i + 1, freq) # THz)</span>











<div class="viewcode-block" id="def_energy"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.def_energy">[docs]</a><span class="k">def</span> <span class="nf">def_energy</span><span class="p">(</span><span class="n">vac</span><span class="o">=</span><span class="p">[],</span><span class="n">parameters</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get specific defect formation energy</span>

<span class="sd">    Args:</span>
<span class="sd">         vac: vacancy structures</span>
<span class="sd">         parameters: LAMMPS input parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">           def_list: defect energy list</span>
<span class="sd">           header_list: defect names</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="c1">#def def_energy(vac=[],parameters={&#39;pair_style&#39;:&#39;eam/alloy&#39;,&#39;pair_coeff&#39;:&#39;/scratch/lfs/kamal/POSMAT/Automatic2/Al03.eam.alloy&#39;,&#39;atom_style&#39;: &#39;charge&#39; ,&#39;control_file&#39;:&#39;/home/kamal/inelast.mod&#39;}):</span>
    <span class="n">def_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">header_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">fi</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;DEF.INFO&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vac</span><span class="p">:</span>
        <span class="n">enp</span><span class="p">,</span><span class="n">strt</span><span class="p">,</span><span class="n">forces</span><span class="o">=</span><span class="n">run_job</span><span class="p">(</span><span class="n">mat</span><span class="o">=</span><span class="n">v</span><span class="p">,</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">)</span>
        <span class="c1">#enp,contc=run_job(mat=v,incar=incar,kpoints=kpoints,jobname=str(v.comment))</span>
        <span class="c1">#strt=Structure.from_file(contc)</span>
        <span class="n">comm</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;running def_energy for =&quot;</span><span class="p">,</span><span class="n">comm</span><span class="p">)</span>
        <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;bulk&#39;</span><span class="p">:</span>
           <span class="n">gs_energy</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">enp</span><span class="p">)</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">strt</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">num_atoms</span><span class="p">)</span>
           <span class="n">gs_str</span><span class="o">=</span><span class="n">strt</span>
           <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;in def_energy gs_energy for&quot;</span><span class="p">,</span><span class="n">comm</span><span class="p">,</span> <span class="n">gs_energy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;strt&#39;</span><span class="p">,</span><span class="n">strt</span><span class="p">)</span>
           <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;gs_str&#39;</span><span class="p">,</span><span class="n">gs_str</span><span class="p">)</span>
           <span class="n">chem_pot</span><span class="o">=</span><span class="n">get_chem_pot</span><span class="p">(</span><span class="n">gs_str</span><span class="p">,</span><span class="n">strt</span><span class="p">,</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;intl&quot;</span><span class="p">):</span>
              <span class="n">chem_pot</span><span class="o">=</span><span class="mf">0.0</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">chem_pot</span><span class="p">)</span>
           <span class="n">def_en</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">enp</span><span class="p">)</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">strt</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">num_atoms</span><span class="p">))</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">gs_energy</span><span class="p">)</span><span class="o">+</span><span class="n">chem_pot</span>
           <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;in def_energy def_en for&quot;</span><span class="p">,</span><span class="n">comm</span><span class="p">,</span> <span class="n">def_en</span><span class="p">,</span><span class="s2">&quot;chem_pot&quot;</span><span class="p">,</span><span class="n">chem_pot</span><span class="p">)</span>
           <span class="n">def_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">def_en</span><span class="p">)</span>
           <span class="nb">print</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">def_en</span><span class="p">)</span>
           <span class="n">line</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">def_en</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
           <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">def_list</span><span class="p">,</span><span class="n">header_list</span></div>


<span class="c1">#def main(p=None, parameters={&#39;pair_style&#39;:&#39;rebomos&#39;,&#39;pair_coeff&#39;:&#39;/scratch/lfs/kamal/JARVIS/All2/MoS2/MoS.REBO.set5b&#39;,&#39;atom_style&#39;: &#39;charge&#39; ,&#39;control_file&#39;:&#39;/home/kamal/inelast.mod&#39;}):</span>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{},</span><span class="n">c_size</span><span class="o">=</span><span class="mi">35</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Master function to run LAMMPS job</span>

<span class="sd">    Args:</span>
<span class="sd">        p: Poscar object</span>
<span class="sd">        parameters: LAMMPS input parameters</span>
<span class="sd">        c_size:cell size</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#p=Poscar.from_file(&quot;POSCAR&quot;)</span>
    <span class="n">c_size</span><span class="o">=</span><span class="mi">35</span>
    <span class="n">sg_mat</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
    <span class="n">mat_cvn</span> <span class="o">=</span> <span class="n">sg_mat</span><span class="o">.</span><span class="n">get_conventional_standard_structure</span><span class="p">()</span>
    <span class="n">dim1</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">c_size</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">mat_cvn</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">])))))</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">dim2</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c_size</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">mat_cvn</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]))))</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">dim3</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c_size</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">mat_cvn</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]))))</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">cellmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">dim1</span><span class="p">,</span><span class="n">dim2</span><span class="p">,</span><span class="n">dim3</span><span class="p">)</span>
    <span class="c1">#print &quot;dim1 dim2 dim3&quot;,dim1,dim2,dim3</span>
    <span class="c1">#mat_cvn.make_supercell([dim1,dim2,dim3])</span>
    <span class="n">mat_pos</span><span class="o">=</span><span class="n">Poscar</span><span class="p">(</span><span class="n">mat_cvn</span><span class="p">)</span>
    <span class="n">mat_pos</span><span class="o">.</span><span class="n">comment</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">mat_pos</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
       <span class="n">toten</span><span class="p">,</span><span class="n">final_str</span><span class="p">,</span><span class="n">forces</span><span class="o">=</span><span class="n">run_job</span><span class="p">(</span><span class="n">mat</span><span class="o">=</span><span class="n">mat_pos</span><span class="p">,</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
       <span class="k">pass</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;p.comment issssss&quot;</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span>
    <span class="n">vac</span><span class="o">=</span><span class="n">vac_antisite_def_struct_gen</span><span class="p">(</span><span class="n">c_size</span><span class="o">=</span><span class="n">c_size</span><span class="p">,</span><span class="n">struct</span><span class="o">=</span><span class="n">final_str</span><span class="p">)</span>
    <span class="n">def_list</span><span class="p">,</span><span class="n">header_list</span><span class="o">=</span><span class="n">def_energy</span><span class="p">(</span><span class="n">vac</span><span class="o">=</span><span class="n">vac</span><span class="p">,</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">def_list</span><span class="p">,</span><span class="n">header_list</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
       <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;p.comment issssss&quot;</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span>
       <span class="n">vac</span><span class="o">=</span><span class="n">vac_antisite_def_struct_gen</span><span class="p">(</span><span class="n">c_size</span><span class="o">=</span><span class="n">c_size</span><span class="p">,</span><span class="n">struct</span><span class="o">=</span><span class="n">final_str</span><span class="p">)</span>
       <span class="n">def_list</span><span class="p">,</span><span class="n">header_list</span><span class="o">=</span><span class="n">def_energy</span><span class="p">(</span><span class="n">vac</span><span class="o">=</span><span class="n">vac</span><span class="p">,</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">)</span>
       <span class="nb">print</span> <span class="p">(</span><span class="n">def_list</span><span class="p">,</span><span class="n">header_list</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
       <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">surf</span><span class="o">=</span><span class="n">pmg_surfer</span><span class="p">(</span><span class="n">mat</span><span class="o">=</span><span class="n">final_str</span><span class="p">,</span> <span class="n">min_slab_size</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span><span class="n">vacuum</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span><span class="n">max_index</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">surf_list</span><span class="p">,</span><span class="n">surf_header_list</span><span class="o">=</span><span class="n">surf_energy</span><span class="p">(</span><span class="n">surf</span><span class="o">=</span><span class="n">surf</span><span class="p">,</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="n">surf_list</span><span class="p">,</span><span class="n">surf_header_list</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
       <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
       <span class="n">cwd</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
       <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;Phonon&quot;</span><span class="p">):</span>
          <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s2">&quot;Phonon&quot;</span><span class="p">)</span>
       <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;Phonon&quot;</span><span class="p">)</span>
       <span class="n">do_phonons</span><span class="p">(</span><span class="n">strt</span><span class="o">=</span><span class="n">final_str</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>
       <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
       <span class="k">pass</span>
    <span class="n">sub_files</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">calc</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.json&quot;</span><span class="p">):</span>
        <span class="n">fold</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cwd</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">target_file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">fold</span><span class="p">)</span>
        <span class="n">dest_file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">fold</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">)</span>
        <span class="n">sub_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dest_file</span><span class="p">)</span>
        <span class="n">ZipDir</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span><span class="n">dest_file</span><span class="p">,</span><span class="n">contents</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;init.mod&#39;</span><span class="p">,</span> <span class="s1">&#39;potential.mod&#39;</span><span class="p">,</span> <span class="s1">&#39;in.elastic&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span>  <span class="s1">&#39;log.lammps&#39;</span><span class="p">,</span> <span class="s1">&#39;restart.equil&#39;</span><span class="p">,</span><span class="s1">&#39;data0&#39;</span> <span class="p">])</span>
    <span class="n">calc</span><span class="o">=</span><span class="n">calc</span><span class="o">+</span><span class="mi">1</span>

    <span class="n">target_file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
    <span class="n">dest_file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Calc-&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">calc</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">)</span>
    <span class="n">ZipDir</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span><span class="n">dest_file</span><span class="p">,</span><span class="n">contents</span><span class="o">=</span><span class="n">sub_files</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.json&quot;</span><span class="p">):</span>
        <span class="n">fold</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cwd</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">dest_file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">fold</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">)</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;rm &quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dest_file</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>

<div class="viewcode-block" id="main_func"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.main_func">[docs]</a><span class="k">def</span> <span class="nf">main_func</span><span class="p">(</span><span class="n">mpid</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">mat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call master job function either using mpid or Poscar object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mpid</span> <span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
       <span class="k">with</span> <span class="n">MPRester</span><span class="p">()</span> <span class="k">as</span> <span class="n">mp</span><span class="p">:</span>
         <span class="n">strt</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">get_structure_by_material_id</span><span class="p">(</span><span class="n">mpid</span><span class="p">)</span>
         <span class="n">mat</span><span class="o">=</span><span class="n">Poscar</span><span class="p">(</span><span class="n">strt</span><span class="p">)</span>

         <span class="n">mpid</span><span class="o">=</span><span class="n">mpid</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
         <span class="n">mpid</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;bulk@&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mpid</span><span class="p">)</span>
         <span class="n">mat</span><span class="o">.</span><span class="n">comment</span><span class="o">=</span><span class="n">mpid</span>

    <span class="n">main</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">mat</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span></div>

<span class="c1">#Example</span>
<div class="viewcode-block" id="main_alloy"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.jlammps.main_alloy">[docs]</a><span class="k">def</span> <span class="nf">main_alloy</span><span class="p">():</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Run alloy FFs job</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.alloy&quot;</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">folder1</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;_nist&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder1</span><span class="p">):</span>
           <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">folder1</span><span class="p">))</span>
        <span class="n">cwd1</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;folder1=&quot;</span><span class="p">,</span><span class="n">folder1</span><span class="p">)</span>
        <span class="n">ff</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">element_ff</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">folder1</span><span class="p">))</span>
        <span class="n">list_el</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">lines</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">content</span><span class="o">=</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="c1">#content=(lines[3]).split(&quot;&#39; &#39;|\n|\r\n&quot;)</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
        
            <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">!=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">!=</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>
               <span class="n">list_el</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">list_el</span><span class="p">)):</span>
             <span class="k">if</span> <span class="n">i</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                 <span class="n">element_ff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_el</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>    
<span class="c1">#    print ff,&#39; &#39;,element_ff</span>
        <span class="k">with</span> <span class="n">MPRester</span><span class="p">(</span><span class="n">MAPI_KEY</span><span class="p">)</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
             <span class="n">data</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_entries_in_chemsys</span><span class="p">(</span><span class="n">element_ff</span><span class="p">,</span><span class="n">inc_structure</span><span class="o">=</span><span class="s1">&#39;final&#39;</span><span class="p">,</span> <span class="n">property_data</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;unit_cell_formula&quot;</span><span class="p">,</span><span class="s2">&quot;material_id&quot;</span><span class="p">,</span><span class="s2">&quot;icsd_id&quot;</span><span class="p">,</span><span class="s2">&quot;spacegroup&quot;</span><span class="p">,</span><span class="s2">&quot;energy_per_atom&quot;</span><span class="p">,</span><span class="s2">&quot;formation_energy_per_atom&quot;</span><span class="p">,</span><span class="s2">&quot;pretty_formula&quot;</span><span class="p">,</span><span class="s2">&quot;band_gap&quot;</span><span class="p">,</span><span class="s2">&quot;total_magnetization&quot;</span><span class="p">,</span><span class="s2">&quot;e_above_hull&quot;</span><span class="p">])</span>
             <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">element_ff</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
                 <span class="k">try</span><span class="p">:</span>
                     <span class="n">entries</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_entries_in_chemsys</span><span class="p">(</span><span class="n">element_ff</span><span class="p">)</span>
                     <span class="n">pd</span> <span class="o">=</span> <span class="n">PhaseDiagram</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
                     <span class="n">plotter</span> <span class="o">=</span> <span class="n">PDPlotter</span><span class="p">(</span><span class="n">pd</span><span class="p">,</span> <span class="n">show_unstable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                     <span class="n">image</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;_DFT&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;.jpg&quot;</span><span class="p">)</span>
                     <span class="n">plotter</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
                 <span class="k">except</span><span class="p">:</span>
                     <span class="k">pass</span>
             <span class="n">structures</span><span class="o">=</span><span class="p">[]</span>
             <span class="n">structures_cvn</span><span class="o">=</span><span class="p">[]</span>
             <span class="n">icsd_arr</span><span class="o">=</span><span class="p">[]</span>
             <span class="n">mp_arr</span><span class="o">=</span><span class="p">[]</span>
             <span class="n">sg_arr</span><span class="o">=</span><span class="p">[]</span>
             <span class="n">enp_arr</span><span class="o">=</span><span class="p">[]</span>
             <span class="n">fenp_arr</span><span class="o">=</span><span class="p">[]</span>
             <span class="n">pf_arr</span><span class="o">=</span><span class="p">[]</span>
             <span class="n">ucf_arr</span><span class="o">=</span><span class="p">[]</span>
             <span class="n">bg_arr</span><span class="o">=</span><span class="p">[]</span>
             <span class="n">tm_arr</span><span class="o">=</span><span class="p">[]</span>
             <span class="n">ehull_arr</span><span class="o">=</span><span class="p">[]</span>
             <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                 <span class="n">x</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;material_id&quot;</span><span class="p">]</span>
                 <span class="n">sg</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;spacegroup&quot;</span><span class="p">]</span>
                 <span class="n">enp</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;energy_per_atom&quot;</span><span class="p">]</span>
                 <span class="n">fenp</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;formation_energy_per_atom&quot;</span><span class="p">]</span>
                 <span class="n">pf</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;pretty_formula&quot;</span><span class="p">]</span>
                 <span class="n">ucf</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;unit_cell_formula&quot;</span><span class="p">]</span>
                 <span class="n">bg</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;band_gap&quot;</span><span class="p">]</span>
                 <span class="n">tm</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;total_magnetization&quot;</span><span class="p">]</span>
                 <span class="n">ehull</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;e_above_hull&quot;</span><span class="p">]</span>
                 <span class="n">icsd</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;icsd_id&quot;</span><span class="p">]</span>
                 <span class="n">structure</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_structure_by_material_id</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                 <span class="n">structures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
                 <span class="n">icsd_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">icsd</span><span class="p">)</span>
                 <span class="n">mp_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                 <span class="n">sg_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sg</span><span class="p">)</span>
                 <span class="n">enp_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">enp</span><span class="p">)</span>
                 <span class="n">fenp_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fenp</span><span class="p">)</span>
                 <span class="n">pf_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pf</span><span class="p">)</span>
                 <span class="n">bg_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bg</span><span class="p">)</span>
                 <span class="n">tm_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tm</span><span class="p">)</span>
                 <span class="n">ucf_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ucf</span><span class="p">)</span>
                 <span class="n">ehull_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ehull</span><span class="p">)</span>
              

                 <span class="n">comment</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;bulk@&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                 <span class="n">folder2</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;_fold&quot;</span><span class="p">)</span>
                 <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder2</span><span class="p">):</span>
                     <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">folder2</span><span class="p">))</span>
                 <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;folder2=&quot;</span><span class="p">,</span><span class="n">folder2</span><span class="p">)</span>
                 <span class="n">cwd2</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
                 <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">folder2</span><span class="p">))</span>

                 <span class="n">p</span><span class="o">=</span><span class="n">Poscar</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
                 <span class="n">p</span><span class="o">.</span><span class="n">comment</span><span class="o">=</span><span class="n">comment</span>
                 <span class="n">p</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="s2">&quot;POSCAR&quot;</span><span class="p">)</span>
                 <span class="n">poscar_file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;/POSCAR&quot;</span><span class="p">)</span>

                 <span class="n">pair_coeff</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">cwd1</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                 <span class="c1">#pair_coeff=str(&#39;/data/knc6/JARVIS-FF-NEW/ALLOY&#39;)+str(&quot;/&quot;)+str(file)</span>
                 <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pair_style&#39;</span><span class="p">:</span><span class="s1">&#39;eam/alloy&#39;</span><span class="p">,</span><span class="s1">&#39;exec&#39;</span><span class="p">:</span><span class="n">lammps_exec</span><span class="p">,</span><span class="s1">&#39;pair_coeff&#39;</span><span class="p">:</span><span class="n">pair_coeff</span><span class="p">,</span><span class="s1">&#39;atom_style&#39;</span><span class="p">:</span> <span class="s1">&#39;charge&#39;</span> <span class="p">,</span><span class="s1">&#39;control_file&#39;</span><span class="p">:</span><span class="n">input_box</span><span class="p">}</span>
                 <span class="n">main_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;setup.py&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
                 <span class="n">line</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;from jlammps import main_func&quot;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="n">main_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                 <span class="n">line</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;from pymatgen.io.vasp.inputs import  Poscar&quot;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="n">main_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                 <span class="c1">#line=str(&quot;try:&quot;)+&#39;\n&#39;</span>
                 <span class="c1">#main_file.write(line)</span>
                 <span class="n">line</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;p=Poscar.from_file(&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">poscar_file</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="n">main_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                 <span class="n">line</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;main_func(mat=p&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;parameters=&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                 <span class="n">main_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                 <span class="c1">#line=str(&quot;except:&quot;)+&#39;\n&#39;</span>
                 <span class="c1">#main_file.write(line)</span>
                 <span class="c1">#line=str(&quot;     pass&quot;)+&#39;\n&#39;</span>
                 <span class="c1">#main_file.write(line)</span>
                 <span class="n">main_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                 <span class="c1">#try:</span>
                 <span class="c1">#    p=Poscar.from_file(poscar_file)</span>
                 <span class="c1">#    main_func(mat=p,parameters=parameters)</span>
                 <span class="c1">#except:</span>
                 <span class="c1">#     pass</span>
                 <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd2</span><span class="p">)</span><span class="c1">#=str(os.getcwd())</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd1</span><span class="p">)</span><span class="c1">#=str(os.getcwd())</span>
    <span class="k">except</span><span class="p">:</span>
       <span class="k">pass</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">jarvis-tools v2018.10.22 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Kamal Choudhary.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>