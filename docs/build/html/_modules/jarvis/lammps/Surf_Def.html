
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>jarvis.lammps.Surf_Def &#8212; jarvis-tools v2018.10.22 documentation</title>
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">jarvis-tools v2018.10.22 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for jarvis.lammps.Surf_Def</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">unicode_literals</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Surface abd defect structure generator</span>
<span class="sd">See DOI: 10.1016/j.cpc.2015.03.015</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="k">import</span> <span class="n">Structure</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.periodic_table</span> <span class="k">import</span> <span class="n">Element</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.vasp</span> <span class="k">import</span> <span class="n">Poscar</span>
<span class="kn">from</span> <span class="nn">pymatgen.analysis.defects.point_defects</span> <span class="k">import</span> <span class="n">ValenceIonicRadiusEvaluator</span><span class="p">,</span><span class="n">Vacancy</span><span class="p">,</span><span class="n">Interstitial</span>
<span class="c1">#from pymatgen.analysis.local_env import ValenceIonicRadiusEvaluator</span>
<span class="kn">from</span> <span class="nn">pymatgen.symmetry.analyzer</span> <span class="k">import</span> <span class="n">SpacegroupAnalyzer</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.vasp</span> <span class="k">import</span> <span class="n">Poscar</span>
<span class="kn">from</span> <span class="nn">monty.serialization</span> <span class="k">import</span> <span class="n">loadfn</span><span class="p">,</span> <span class="n">dumpfn</span>
<span class="kn">from</span> <span class="nn">monty.json</span> <span class="k">import</span> <span class="n">MontyEncoder</span><span class="p">,</span> <span class="n">MontyDecoder</span>
<span class="c1">#from pymatgen.analysis.defects.point_defects import Vacancy</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.surface</span> <span class="k">import</span> <span class="n">Slab</span><span class="p">,</span> <span class="n">SlabGenerator</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="k">import</span> <span class="n">Structure</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.ase</span> <span class="k">import</span> <span class="n">AseAtomsAdaptor</span>
<span class="kn">from</span> <span class="nn">ase.lattice.surface</span> <span class="k">import</span> <span class="n">surface</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.surface</span> <span class="k">import</span>  <span class="n">Slab</span><span class="p">,</span> <span class="n">SlabGenerator</span><span class="p">,</span> <span class="n">generate_all_slabs</span><span class="p">,</span><span class="n">get_symmetrically_distinct_miller_indices</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.vasp</span> <span class="k">import</span> <span class="n">Kpoints</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.vasp</span> <span class="k">import</span> <span class="n">Vasprun</span>
<span class="kn">from</span> <span class="nn">pymatgen.symmetry.analyzer</span> <span class="k">import</span> <span class="n">SpacegroupAnalyzer</span>
<span class="kn">from</span> <span class="nn">pymatgen.analysis.defects.dilute_solution_model</span> <span class="k">import</span> \
            <span class="n">compute_defect_density</span><span class="p">,</span> <span class="n">solute_defect_density</span>
<span class="k">try</span><span class="p">:</span>
  <span class="kn">from</span> <span class="nn">pymatgen.analysis.defects.point_defects</span> <span class="k">import</span> <span class="n">Vacancy</span><span class="p">,</span><span class="n">Interstitial</span><span class="p">,</span><span class="n">ValenceIonicRadiusEvaluator</span>
<span class="k">except</span><span class="p">:</span>
  <span class="kn">from</span> <span class="nn">pymatgen.analysis.defects.core</span> <span class="k">import</span> <span class="n">Vacancy</span><span class="p">,</span><span class="n">Interstitial</span>
  <span class="k">pass</span>

<span class="k">try</span><span class="p">:</span> 
  <span class="kn">from</span> <span class="nn">pymatgen.ext.matproj</span> <span class="k">import</span> <span class="n">MPRester</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>

<div class="viewcode-block" id="get_sc_scale"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.Surf_Def.get_sc_scale">[docs]</a><span class="k">def</span> <span class="nf">get_sc_scale</span><span class="p">(</span><span class="n">inp_struct</span><span class="p">,</span> <span class="n">final_site_no</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    scale up structure</span>

<span class="sd">    Args:</span>
<span class="sd">        inp_struct: initial input structure</span>
<span class="sd">        final_site_no: final number of atoms</span>
<span class="sd">    Returns:</span>
<span class="sd">           number of multipliers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="n">inp_struct</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span>
    <span class="n">no_sites</span> <span class="o">=</span> <span class="n">inp_struct</span><span class="o">.</span><span class="n">num_sites</span>
    <span class="n">mult</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_site_no</span><span class="o">/</span><span class="n">no_sites</span><span class="o">*</span><span class="n">lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">num_mult</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mult</span><span class="o">/</span><span class="n">l</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">]</span>
    <span class="n">num_mult</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">num_mult</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">num_mult</span></div>


<div class="viewcode-block" id="vac_antisite_def_struct_gen"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.Surf_Def.vac_antisite_def_struct_gen">[docs]</a><span class="k">def</span> <span class="nf">vac_antisite_def_struct_gen</span><span class="p">(</span><span class="n">c_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">mpid</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">struct</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vacancy, antisite generator</span>

<span class="sd">    Args:</span>
<span class="sd">         c_size: cell size</span>
<span class="sd">         struct: Structure object or</span>
<span class="sd">         mpid: materials project id</span>
<span class="sd">    Returns:</span>
<span class="sd">            def_str: defect structures in Poscar object format</span>
<span class="sd">    &quot;&quot;&quot;</span>     
    <span class="n">def_str</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="n">struct</span> <span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">MPRester</span><span class="p">()</span> <span class="k">as</span> <span class="n">mp</span><span class="p">:</span>
                <span class="n">struct</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">get_structure_by_material_id</span><span class="p">(</span><span class="n">mpid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mpid</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
           <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Provide structure&quot;</span><span class="p">)</span>
    <span class="n">c_size</span><span class="o">=</span><span class="n">c_size</span>
    <span class="n">dim1</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">c_size</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">])))))</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">dim2</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c_size</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]))))</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">dim3</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c_size</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]))))</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">cellmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">dim1</span><span class="p">,</span><span class="n">dim2</span><span class="p">,</span><span class="n">dim3</span><span class="p">)</span>
    <span class="c1">#print (&quot;in vac_def cellmax=&quot;,cell</span>
    <span class="n">prim_struct_sites</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">sites</span><span class="p">)</span>
    <span class="n">struct</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">struct</span><span class="p">)</span><span class="o">.</span><span class="n">get_conventional_standard_structure</span><span class="p">()</span>
    <span class="n">conv_struct_sites</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">sites</span><span class="p">)</span>
    <span class="n">conv_prim_rat</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">conv_struct_sites</span><span class="o">/</span><span class="n">prim_struct_sites</span><span class="p">)</span>
    <span class="c1">#sc_scale = get_sc_scale(struct,cellmax)</span>
    <span class="n">sc_scale</span><span class="o">=</span><span class="p">[</span><span class="n">dim1</span><span class="p">,</span><span class="n">dim2</span><span class="p">,</span><span class="n">dim3</span><span class="p">]</span>
    <span class="c1">#sc_scale=[cellmax,cellmax,cellmax]</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;sc_scale&quot;</span><span class="p">,</span><span class="n">sc_scale</span><span class="p">)</span>
    <span class="c1">#mpvis = MITRelaxSet #MPGGAVaspInputSet()</span>

    <span class="c1"># Begin defaults: All default settings.</span>
    <span class="c1">#blk_vasp_incar_param = {&#39;IBRION&#39;:-1,&#39;EDIFF&#39;:1e-4,&#39;EDIFFG&#39;:0.001,&#39;NSW&#39;:0,}</span>
    <span class="c1">#def_vasp_incar_param = {&#39;ISIF&#39;:2,&#39;NELM&#39;:99,&#39;IBRION&#39;:2,&#39;EDIFF&#39;:1e-6, </span>
    <span class="c1">#                        &#39;EDIFFG&#39;:0.001,&#39;NSW&#39;:40,}</span>
    <span class="c1">#kpoint_den = 6000</span>
    <span class="c1"># End defaults</span>
    
    <span class="c1">#ptcr_flag = True</span>
    <span class="c1">#try:</span>
    <span class="c1">#    potcar = mpvis.get_potcar(struct)</span>
    <span class="c1">#except:</span>
    <span class="c1">#    print (&quot;VASP POTCAR folder not detected.\n&quot; \</span>
    <span class="c1">#          &quot;Only INCAR, POSCAR, KPOINTS are generated.\n&quot; \</span>
    <span class="c1">#          &quot;If you have VASP installed on this system, \n&quot; \</span>
    <span class="c1">#          &quot;refer to pymatgen documentation for configuring the settings.&quot;)</span>
    <span class="c1">#    ptcr_flag = False</span>





    <span class="n">struct_valrad_eval</span> <span class="o">=</span> <span class="n">ValenceIonicRadiusEvaluator</span><span class="p">(</span><span class="n">struct</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">struct_valrad_eval</span><span class="o">.</span><span class="n">valences</span>
    <span class="n">rad</span> <span class="o">=</span> <span class="n">struct_valrad_eval</span><span class="o">.</span><span class="n">radii</span>
    <span class="n">struct_val</span> <span class="o">=</span> <span class="n">val</span>
    <span class="n">struct_rad</span> <span class="o">=</span> <span class="n">rad</span>



    <span class="n">vac</span> <span class="o">=</span> <span class="n">Vacancy</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{})</span>
    <span class="n">scs</span> <span class="o">=</span> <span class="n">vac</span><span class="o">.</span><span class="n">make_supercells_with_defects</span><span class="p">(</span><span class="n">sc_scale</span><span class="p">)</span>
    <span class="c1">#site_no = scs[0].num_sites</span>
    <span class="c1">#if site_no &gt; cellmax:</span>
    <span class="c1">#    max_sc_dim = max(sc_scale)</span>
    <span class="c1">#    i = sc_scale.index(max_sc_dim)</span>
    <span class="c1">#    sc_scale[i] -= 1</span>
    <span class="c1">#    scs = vac.make_supercells_with_defects(sc_scale)</span>
    <span class="c1">#print (&#39;struct&#39;,scs)</span>


    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scs</span><span class="p">)):</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="n">scs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1">#print (type(sc))</span>
        <span class="n">poscar</span> <span class="o">=</span> <span class="n">Poscar</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span> <span class="c1">#mpvis.get_poscar(sc)</span>
        <span class="c1">#kpoints = Kpoints.automatic_density(sc,kpoint_den)</span>
        <span class="c1">#incar = mpvis.get_incar(sc)</span>
        <span class="c1">#if ptcr_flag:</span>
        <span class="c1">#    potcar = mpvis.get_potcar(sc)</span>

        <span class="n">interdir</span> <span class="o">=</span> <span class="n">mpid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">fin_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">interdir</span><span class="p">,</span><span class="s1">&#39;bulk&#39;</span><span class="p">)</span>
            <span class="c1">#try:</span>
            <span class="c1">#    os.makedirs(fin_dir)</span>
            <span class="c1">#except:</span>
            <span class="c1">#    pass</span>
            <span class="c1">#incar.update(blk_vasp_incar_param)</span>
            <span class="c1">#incar.write_file(os.path.join(fin_dir,&#39;INCAR&#39;))</span>
            <span class="c1">#poscar.write_file(os.path.join(fin_dir,&#39;POSCAR&#39;))</span>
            <span class="n">poscar</span><span class="o">.</span><span class="n">comment</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;bulk&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;cellmax&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cellmax</span><span class="p">)</span>
            <span class="n">def_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poscar</span><span class="p">)</span>
            <span class="n">poscar</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="s1">&#39;POSCAR-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;bulk&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;.vasp&quot;</span><span class="p">))</span>
            <span class="c1">#if ptcr_flag:</span>
            <span class="c1">#    potcar.write_file(os.path.join(fin_dir,&#39;POTCAR&#39;))</span>
            <span class="c1">#kpoints.write_file(os.path.join(fin_dir,&#39;KPOINTS&#39;))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">blk_str_sites</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">scs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sites</span><span class="p">)</span>
            <span class="n">vac_str_sites</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">sites</span><span class="p">)</span>
            <span class="n">vac_sites</span> <span class="o">=</span> <span class="n">blk_str_sites</span> <span class="o">-</span> <span class="n">vac_str_sites</span>
            <span class="n">vac_site</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">vac_sites</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">site_mult</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vac</span><span class="o">.</span><span class="n">get_defectsite_multiplicity</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">conv_prim_rat</span><span class="p">)</span>
            <span class="c1">#try:</span>
            <span class="c1">#   site_mult = int(vac.get_defectsite_multiplicity(i-1)/conv_prim_rat)</span>
            <span class="c1">#except:</span>
            <span class="c1">#   site_mult=1</span>
            <span class="c1">#   pass</span>
            <span class="n">vac_site_specie</span> <span class="o">=</span> <span class="n">vac_site</span><span class="o">.</span><span class="n">specie</span>
            <span class="n">vac_symbol</span> <span class="o">=</span> <span class="n">vac_site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span>

            <span class="n">vac_dir</span> <span class="o">=</span><span class="s1">&#39;vacancy_</span><span class="si">{}</span><span class="s1">_mult-</span><span class="si">{}</span><span class="s1">_sitespecie-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                    <span class="n">site_mult</span><span class="p">,</span> <span class="n">vac_symbol</span><span class="p">)</span>
            <span class="n">fin_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">interdir</span><span class="p">,</span><span class="n">vac_dir</span><span class="p">)</span>
            <span class="c1">#try:</span>
            <span class="c1">#    os.makedirs(fin_dir)</span>
            <span class="c1">#except:</span>
            <span class="c1">#    pass</span>
            <span class="c1">#incar.update(def_vasp_incar_param)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">poscar</span><span class="o">.</span><span class="n">comment</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">vac_dir</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;cellmax&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cellmax</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">pos</span><span class="o">=</span><span class="n">poscar</span>
            <span class="c1">#pos=poscar.structure</span>
            <span class="n">def_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
            <span class="c1">#poscar.write_file(os.path.join(fin_dir,&#39;POSCAR&#39;))</span>
            <span class="n">poscar</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="s1">&#39;POSCAR-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">vac_dir</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;.vasp&quot;</span><span class="p">))</span>
            <span class="c1">#incar.write_file(os.path.join(fin_dir,&#39;INCAR&#39;))</span>
            <span class="c1">#if ptcr_flag:</span>
            <span class="c1">#    potcar.write_file(os.path.join(fin_dir,&#39;POTCAR&#39;))</span>
            <span class="c1">#kpoints.write_file(os.path.join(fin_dir,&#39;KPOINTS&#39;))</span>

            <span class="c1"># Antisite generation at all vacancy sites</span>
            <span class="n">struct_species</span> <span class="o">=</span> <span class="n">scs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">types_of_specie</span>
            <span class="k">for</span> <span class="n">specie</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">struct_species</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">([</span><span class="n">vac_site_specie</span><span class="p">]):</span>
                <span class="n">subspecie_symbol</span> <span class="o">=</span> <span class="n">specie</span><span class="o">.</span><span class="n">symbol</span>
                <span class="n">anti_struct</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">anti_struct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">specie</span><span class="p">,</span> <span class="n">vac_site</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">)</span>
                
                <span class="n">poscar</span> <span class="o">=</span> <span class="n">Poscar</span><span class="p">(</span><span class="n">anti_struct</span><span class="p">)</span>
                <span class="c1">#incar = mpvis.get_incar(anti_struct)</span>
                <span class="c1">#incar.update(def_vasp_incar_param)</span>
                <span class="n">as_dir</span> <span class="o">=</span><span class="s1">&#39;antisite_</span><span class="si">{}</span><span class="s1">_mult-</span><span class="si">{}</span><span class="s1">_sitespecie-</span><span class="si">{}</span><span class="s1">_subspecie-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">site_mult</span><span class="p">,</span> <span class="n">vac_symbol</span><span class="p">,</span> <span class="n">subspecie_symbol</span><span class="p">)</span>
                <span class="n">fin_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">interdir</span><span class="p">,</span><span class="n">as_dir</span><span class="p">)</span>
                <span class="c1">#try:</span>
                <span class="c1">#    os.makedirs(fin_dir)</span>
                <span class="c1">#except:</span>
                <span class="c1">#    pass</span>
                <span class="n">poscar</span><span class="o">.</span><span class="n">comment</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">as_dir</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;cellmax&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cellmax</span><span class="p">)</span>
                <span class="n">pos</span><span class="o">=</span><span class="n">poscar</span>
                <span class="c1">#pos=poscar.structure</span>
                <span class="n">def_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
                <span class="c1">#poscar.write_file(os.path.join(fin_dir,&#39;POSCAR&#39;))</span>
                <span class="n">poscar</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="s1">&#39;POSCAR-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">as_dir</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;.vasp&quot;</span><span class="p">))</span>
                <span class="c1">#incar.write_file(os.path.join(fin_dir,&#39;INCAR&#39;))</span>
                <span class="c1">#if ptcr_flag:</span>
                <span class="c1">#        potcar.write_file(os.path.join(fin_dir,&#39;POTCAR&#39;))</span>
                <span class="c1">#kpoints.write_file(os.path.join(fin_dir,&#39;KPOINTS&#39;))</span>
    <span class="c1">#try:</span>
    <span class="c1">#    struct.make_supercell(sc_scale) </span>
    <span class="c1">#    intl = Interstitial(struct, val, rad)</span>
    <span class="c1">#    cell_arr=sc_scale</span>
    <span class="c1">#    for el in struct.composition.elements:</span>
    <span class="c1">#        scs = intl.make_supercells_with_defects(1,el)</span>
    <span class="c1">#        #scs = intl.make_supercells_with_defects(cell_arr,el)</span>
    <span class="c1">#        for i in range(1,len(scs)):</span>
    <span class="c1">#           pos=Poscar(scs[i])</span>
    <span class="c1">#           pos.comment=str(&#39;intl_&#39;)+str(&#39;cellmax&#39;)+str(cellmax)+str(&#39;@&#39;)+str(intl.get_defectsite_coordination_number(i-1))+str(&#39;Element&#39;)+str(el)</span>
    <span class="c1">#           def_str.append(pos)</span>
    <span class="c1">#           pos.write_file(&#39;POSCAR-&#39;+str(&#39;intl_&#39;)+str(&#39;cellmax&#39;)+str(cellmax)+str(&#39;@&#39;)+str(intl.get_defectsite_coordination_number(i-1))+str(&#39;Element&#39;)+str(el))</span>

    <span class="c1">#except:</span>
    <span class="c1">#      pass</span>

    <span class="k">return</span> <span class="n">def_str</span></div>

<div class="viewcode-block" id="pmg_surfer"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.Surf_Def.pmg_surfer">[docs]</a><span class="k">def</span> <span class="nf">pmg_surfer</span><span class="p">(</span><span class="n">mpid</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">vacuum</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">mat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">max_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">min_slab_size</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pymatgen surface builder for a Poscar</span>

<span class="sd">    Args:</span>
<span class="sd">        vacuum: vacuum region</span>
<span class="sd">        mat: Structure object</span>
<span class="sd">        max_index: maximum miller index</span>
<span class="sd">        min_slab_size: minimum slab size</span>

<span class="sd">    Returns:</span>
<span class="sd">           structures: list of surface Structure objects</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">mat</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">MPRester</span><span class="p">()</span> <span class="k">as</span> <span class="n">mp</span><span class="p">:</span>
               <span class="n">mat</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">get_structure_by_material_id</span><span class="p">(</span><span class="n">mpid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mpid</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
          <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Provide structure&#39;</span><span class="p">)</span>

    <span class="n">sg_mat</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
    <span class="n">mat_cvn</span> <span class="o">=</span> <span class="n">sg_mat</span><span class="o">.</span><span class="n">get_conventional_standard_structure</span><span class="p">()</span>
    <span class="n">mat_cvn</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">get_symmetrically_distinct_miller_indices</span><span class="p">(</span><span class="n">mat_cvn</span><span class="p">,</span> <span class="n">max_index</span><span class="p">)</span>
    <span class="c1">#ase_atoms = AseAtomsAdaptor().get_atoms(mat_cvn)</span>

    <span class="n">structures</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">pos</span><span class="o">=</span><span class="n">Poscar</span><span class="p">(</span><span class="n">mat_cvn</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
       <span class="n">pos</span><span class="o">.</span><span class="n">comment</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;sbulk&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;vac&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">vacuum</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">min_slab_size</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
       <span class="k">pass</span>
    <span class="n">structures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
    <span class="n">mat_cvn</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;poscar&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;POSCAR-&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;cvn&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;.vasp&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="n">slab</span><span class="o">=</span><span class="n">SlabGenerator</span><span class="p">(</span><span class="n">initial_structure</span> <span class="o">=</span> <span class="n">mat_cvn</span><span class="p">,</span> <span class="n">miller_index</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">min_slab_size</span><span class="o">=</span> <span class="n">min_slab_size</span><span class="p">,</span> <span class="n">min_vacuum_size</span><span class="o">=</span><span class="n">vacuum</span> <span class="p">,</span> <span class="n">lll_reduce</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">center_slab</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">primitive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">get_slab</span><span class="p">()</span>
        <span class="n">normal_slab</span> <span class="o">=</span> <span class="n">slab</span><span class="o">.</span><span class="n">get_orthogonal_c_slab</span><span class="p">()</span>
        <span class="n">slab_pymatgen</span> <span class="o">=</span> <span class="n">Poscar</span><span class="p">(</span><span class="n">normal_slab</span><span class="p">)</span><span class="o">.</span><span class="n">structure</span>
        <span class="c1">#ase_slab.center(vacuum=vacuum, axis=2)</span>
        <span class="c1">#slab_pymatgen = AseAtomsAdaptor().get_structure(ase_slab)</span>
        <span class="n">xy_size</span><span class="o">=</span><span class="n">min_slab_size</span>
        <span class="n">dim1</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">xy_size</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">slab_pymatgen</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">])))))</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">dim2</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">xy_size</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">slab_pymatgen</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]))))</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">slab_pymatgen</span><span class="o">.</span><span class="n">make_supercell</span><span class="p">([</span><span class="n">dim1</span><span class="p">,</span><span class="n">dim2</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">slab_pymatgen</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">surf_name</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
        <span class="n">pos</span><span class="o">=</span><span class="n">Poscar</span><span class="p">(</span><span class="n">slab_pymatgen</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
           <span class="n">pos</span><span class="o">.</span><span class="n">comment</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Surf-&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">surf_name</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;vac&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">vacuum</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">min_slab_size</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
           <span class="k">pass</span>
        <span class="n">pos</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;POSCAR-&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Surf-&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">surf_name</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;.vasp&#39;</span><span class="p">))</span>
        <span class="n">structures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">structures</span></div>

<div class="viewcode-block" id="surfer"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.Surf_Def.surfer">[docs]</a><span class="k">def</span> <span class="nf">surfer</span><span class="p">(</span><span class="n">mpid</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">vacuum</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">layers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">mat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">max_index</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ASE surface bulder</span>

<span class="sd">    Args:</span>
<span class="sd">        vacuum: vacuum region</span>
<span class="sd">        mat: Structure object</span>
<span class="sd">        max_index: maximum miller index</span>
<span class="sd">        min_slab_size: minimum slab size</span>

<span class="sd">    Returns:</span>
<span class="sd">           structures: list of surface Structure objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="k">if</span> <span class="n">mat</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">MPRester</span><span class="p">()</span> <span class="k">as</span> <span class="n">mp</span><span class="p">:</span>
               <span class="n">mat</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">get_structure_by_material_id</span><span class="p">(</span><span class="n">mpid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mpid</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
          <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Provide structure&#39;</span><span class="p">)</span>

    <span class="n">sg_mat</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
    <span class="n">mat_cvn</span> <span class="o">=</span> <span class="n">sg_mat</span><span class="o">.</span><span class="n">get_conventional_standard_structure</span><span class="p">()</span>
    <span class="n">mat_cvn</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">get_symmetrically_distinct_miller_indices</span><span class="p">(</span><span class="n">mat_cvn</span><span class="p">,</span> <span class="n">max_index</span><span class="p">)</span>
    <span class="n">ase_atoms</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">(</span><span class="n">mat_cvn</span><span class="p">)</span>

    <span class="n">structures</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">pos</span><span class="o">=</span><span class="n">Poscar</span><span class="p">(</span><span class="n">mat_cvn</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
       <span class="n">pos</span><span class="o">.</span><span class="n">comment</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;sbulk&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;vac&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">vacuum</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;layers&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
       <span class="k">pass</span>
    <span class="n">structures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
    <span class="n">mat_cvn</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;poscar&#39;</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;POSCAR-&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;cvn&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;.vasp&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="n">ase_slab</span> <span class="o">=</span> <span class="n">surface</span><span class="p">(</span><span class="n">ase_atoms</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">layers</span><span class="p">)</span>
        <span class="n">ase_slab</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">vacuum</span><span class="o">=</span><span class="n">vacuum</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">slab_pymatgen</span> <span class="o">=</span> <span class="n">AseAtomsAdaptor</span><span class="p">()</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">ase_slab</span><span class="p">)</span>
        <span class="n">slab_pymatgen</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">surf_name</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
        <span class="n">pos</span><span class="o">=</span><span class="n">Poscar</span><span class="p">(</span><span class="n">slab_pymatgen</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
           <span class="n">pos</span><span class="o">.</span><span class="n">comment</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Surf-&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">surf_name</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;vac&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">vacuum</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;layers&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
           <span class="k">pass</span>
        <span class="n">pos</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;POSCAR-&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;Surf-&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">surf_name</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;.vasp&#39;</span><span class="p">))</span>
        <span class="n">structures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">structures</span></div>


<div class="viewcode-block" id="vac_intl"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.Surf_Def.vac_intl">[docs]</a><span class="k">def</span> <span class="nf">vac_intl</span><span class="p">(</span><span class="n">cellmax</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">mpid</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">struct</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vacancy and interstitial generator</span>

<span class="sd">    Args:</span>
<span class="sd">        cellmax: maximum cell size</span>
<span class="sd">        struct: Structure object</span>
<span class="sd">    Returns:</span>
<span class="sd">            def_str: defect structures</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">struct</span> <span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">MPRester</span><span class="p">()</span> <span class="k">as</span> <span class="n">mp</span><span class="p">:</span>
                <span class="n">struct</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">get_structure_by_material_id</span><span class="p">(</span><span class="n">mpid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mpid</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
           <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Provide structure&quot;</span><span class="p">)</span>
    <span class="n">sg_mat</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">struct</span><span class="p">)</span>
    <span class="n">struct</span> <span class="o">=</span> <span class="n">sg_mat</span><span class="o">.</span><span class="n">get_conventional_standard_structure</span><span class="p">()</span>
    <span class="n">def_str</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">cell_arr</span><span class="o">=</span><span class="p">[</span><span class="n">cellmax</span><span class="p">,</span><span class="n">cellmax</span><span class="p">,</span><span class="n">cellmax</span><span class="p">]</span>
    <span class="n">vac</span> <span class="o">=</span> <span class="n">Vacancy</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{})</span>
    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">symbol_set</span><span class="p">):</span>
   
        <span class="n">scs</span> <span class="o">=</span> <span class="n">vac</span><span class="o">.</span><span class="n">make_supercells_with_defects</span><span class="p">(</span><span class="n">cell_arr</span><span class="p">,</span><span class="n">el</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scs</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
               <span class="n">pos</span><span class="o">=</span><span class="n">Poscar</span><span class="p">(</span><span class="n">scs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
               <span class="n">pos</span><span class="o">.</span><span class="n">comment</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;bulk&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;cellmax&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cellmax</span><span class="p">)</span>
               <span class="k">if</span> <span class="n">count</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                   <span class="n">def_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
                   <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">pos</span><span class="o">=</span><span class="n">Poscar</span><span class="p">(</span><span class="n">scs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
               <span class="n">pos</span><span class="o">.</span><span class="n">comment</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;vac&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;cellmax&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cellmax</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">vac</span><span class="o">.</span><span class="n">get_defectsite_multiplicity</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;Element&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
               <span class="k">if</span> <span class="n">pos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">def_str</span><span class="p">:</span>
                   <span class="n">def_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
    <span class="n">struct_valrad_eval</span> <span class="o">=</span> <span class="n">ValenceIonicRadiusEvaluator</span><span class="p">(</span><span class="n">struct</span><span class="p">)</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">struct_valrad_eval</span><span class="o">.</span><span class="n">valences</span>
    <span class="n">rad</span> <span class="o">=</span> <span class="n">struct_valrad_eval</span><span class="o">.</span><span class="n">radii</span>
    <span class="n">struct_val</span> <span class="o">=</span> <span class="n">val</span>
    <span class="n">struct_rad</span> <span class="o">=</span> <span class="n">rad</span>
    <span class="n">intl</span> <span class="o">=</span> <span class="n">Interstitial</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">rad</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">struct</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
        <span class="n">scs</span> <span class="o">=</span> <span class="n">intl</span><span class="o">.</span><span class="n">make_supercells_with_defects</span><span class="p">(</span><span class="n">cell_arr</span><span class="p">,</span><span class="n">el</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">scs</span><span class="p">)):</span>
           <span class="n">pos</span><span class="o">=</span><span class="n">Poscar</span><span class="p">(</span><span class="n">scs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
           <span class="n">pos</span><span class="o">.</span><span class="n">comment</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;intl&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;cellmax&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cellmax</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">intl</span><span class="o">.</span><span class="n">get_defectsite_coordination_number</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;Element&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
           <span class="k">if</span> <span class="n">pos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">def_str</span><span class="p">:</span>
                   <span class="n">def_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">def_str</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">def_str</span></div>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../../jarvis.lammps.html#jarvis.lammps.Surf_Def.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">pp</span><span class="o">=</span><span class="n">vac_antisite_def_struct_gen</span><span class="p">(</span><span class="n">cellmax</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">mpid</span><span class="o">=</span><span class="s1">&#39;mp-134&#39;</span><span class="p">)</span></div>
    <span class="c1">#pp=vac_intl(cellmax=128,mpid=&#39;mp-134&#39;)</span>
<span class="c1">#    ss=surfer(mpid=&#39;mp-134&#39;)</span>
<span class="c1">#    print ss</span>
<span class="c1">#main()</span>
<span class="c1">#strt = Structure.from_file(&quot;POSCAR&quot;)</span>
<span class="c1">#vac_antisite_def_struct_gen(struct=strt)</span>

</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">jarvis-tools v2018.10.22 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Kamal Choudhary.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>